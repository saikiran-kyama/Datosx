<template>
    <!-- Highlights Panel -->
    <div class="highlights slds-clearfix slds-page-header slds-page-header_record-home">
        <div class="slds-grid primaryFieldRow">
            <div class="slds-grid slds-col slds-has-flexi-truncate">
                <!-- <div class="slds-media slds-no-space">
                    <div class="highlights-icon-container slds-avatar slds-m-right_small icon" style="background-color: #df6184">
                        <img alt="Project" src="https://app-business-9844--techmpar.sandbox.my.site.com/img/icon/t4v35/custom/custom13_120.png">
                    </div>
                </div> -->
                <div class="slds-media__body">
                    <h1>
                        <div class="entityNameTitle slds-line-height--reset">Health System ID: {healthSystem.hsId}</div>
                        <span
                            class="slds-page-header__title slds-m-right--small slds-align-middle slds-line-clamp clip-text">{healthSystem.hsName}</span>
                    </h1>
                </div>
            </div>
            <div class="slds-col slds-no-flex slds-grid slds-grid_vertical-align-center horizontal actionsContainer">
                <!-- <lightning-button class="slds-m-right_x-small" variant="neutral" label="Project Scoping Questionnaire Form"></lightning-button>
                <lightning-button class="slds-m-right_x-small" variant="neutral" label="Protocol Questionnaire Form"></lightning-button>
                <lightning-button class="slds-m-right_x-small" variant="neutral" label="Printable View"></lightning-button> -->
                <lightning-button variant="neutral" label="Back" icon-name="utility:back"
                    onclick={handleBackClick}></lightning-button>
            </div>
        </div>
        <div class="secondaryFields" role="presentation">
            <div class="slds-grid slds-page-header__detail-row equal-space"
                style="width: 107%;     background-color: #fffce4;">
                <div class="slds-page-header__detail-block">
                    <p class="slds-text-title slds-truncate">HS Name</p>
                    <p class="fieldComponent slds-text-body--regular slds-show_inline-block slds-truncate">
                        {healthSystem.hsName}</p>
                </div>
                <div class="slds-page-header__detail-block">
                    <p class="slds-text-title slds-truncate">Status</p>
                    <p class="fieldComponent slds-text-body--regular slds-show_inline-block slds-truncate">
                        {healthSystem.status}</p>
                </div>
                <div class="slds-page-header__detail-block">
                    <p class="slds-text-title slds-truncate">State</p>
                    <p class="fieldComponent slds-text-body--regular slds-show_inline-block slds-truncate">
                        {healthSystem.state}</p>
                </div>
                <div class="slds-page-header__detail-block">
                    <p class="slds-text-title slds-truncate">City</p>
                    <p class="fieldComponent slds-text-body--regular slds-show_inline-block slds-truncate">
                        {healthSystem.city}</p>
                </div>
                <div class="slds-page-header__detail-block">
                    <p class="slds-text-title slds-truncate">Contact</p>
                    <p class="fieldComponent slds-text-body--regular slds-show_inline-block slds-truncate">
                        {healthSystem.contact}</p>
                </div>
                <div class="slds-page-header__detail-block">
                    <p class="slds-text-title slds-truncate">Email</p>
                    <p class="fieldComponent slds-text-body--regular slds-show_inline-block slds-truncate">
                        {healthSystem.email}</p>
                </div>
                <div class="slds-page-header__detail-block">
                    <p class="slds-text-title slds-truncate">Phone</p>
                    <p class="fieldComponent slds-text-body--regular slds-show_inline-block slds-truncate">
                        {healthSystem.phone}</p>
                </div>
                <div class="slds-page-header__detail-block">
                    <p class="slds-text-title slds-truncate">Last Updated</p>
                    <p class="fieldComponent slds-text-body--regular slds-show_inline-block slds-truncate">
                        {healthSystem.lastUpdated}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="uiTabset--base uiTabset--default uiTabset" style="margin-left: -3px;">
        <div role="tablist" class="uiTabBar">
            <ul role="presentation" class="tabs__nav" style="gap: 20px; align-items: center;">
                <!-- Overview tab removed per request -->


                <li role="presentation" class={detailsTabClass} style="padding: 0; margin: 0;">
                    <a aria-selected="true" role="tab" tabindex="0" title="Details" class="tabHeader"
                        href="javascript:void(0);" data-tab="Details" onclick={handleTabClick} style="padding: 8px 12px;">
                        <span class="title">Profile</span>
                    </a>
                </li>

                <li role="presentation" class={requirementsTabClass} style="padding: 0; margin: 0;">
                    <a aria-selected="false" role="tab" tabindex="-1" title="Requirements" class="tabHeader"
                        href="javascript:void(0);" data-tab="Requirements" onclick={handleTabClick} style="padding: 8px 12px;">
                        <span class="title">Qualification</span>
                    </a>
                </li>


                <li role="presentation" class={projectTabClass} style="padding: 0; margin: 0;">
                    <a aria-selected="false" role="tab" tabindex="-1" title="Project" class="tabHeader"
                        href="javascript:void(0);" data-tab="Project" onclick={handleTabClick} style="padding: 8px 12px;">
                        <span class="title">Project</span>
                    </a>
                </li>


                <li role="presentation" class={possibilitiesTabClass} style="padding: 0; margin: 0;">
                    <a aria-selected="false" role="tab" tabindex="-1" title="Possibilities" class="tabHeader"
                        href="javascript:void(0);" data-tab="Possibilities" onclick={handleTabClick} style="padding: 8px 12px;">
                        <span class="title">Possibilities</span>
                    </a>
                </li>

                <li role="presentation" class={messagingTabClass} style="padding: 0; margin: 0;">
                    <a aria-selected="false" role="tab" tabindex="-1" title="Messaging" class="tabHeader"
                        href="javascript:void(0);" data-tab="Messaging" onclick={handleTabClick} style="padding: 8px 12px;">
                        <span class="title">Messaging</span>
                    </a>
                </li>

                <li role="presentation" class={legalTabClass} style="padding: 0; margin: 0;">
                    <a aria-selected="false" role="tab" tabindex="-1" title="Legal" class="tabHeader"
                        href="javascript:void(0);" data-tab="Legal" onclick={handleTabClick} style="padding: 8px 12px;">
                        <span class="title">Agreements</span>
                    </a>
                </li>
                <li role="presentation" class={relatedTabClass} style="padding: 0; margin: 0;">
                    <a aria-selected="false" role="tab" tabindex="-1" title="Related" class="tabHeader"
                        href="javascript:void(0);" data-tab="Related" onclick={handleTabClick} style="padding: 8px 12px;">
                        <span class="title">Notes</span>
                    </a>
                </li>
                
                
            </ul>
        </div>


        <!-- Overview content removed -->

            <template if:true={isDetails}>
                <section role="tabpanel" aria-expanded="true"
                    class="record-home-details record-home-tab tabs__content active uiTab">
                    <div class="slds-card slds-m-top_small">
                        <div class="slds-card__body slds-card__body_inner">
                            <div class="slds-grid slds-grid_pull-padded profile-cards-container">
                                <!-- HS Details Card -->
                                <div class="slds-col slds-size_1-of-3 slds-p-horizontal_small">
                                    <div class="profile-card">
                                        <div class="profile-card-header">
                                            <lightning-icon icon-name="standard:record" size="small" class="profile-card-icon"></lightning-icon>
                                            <span class="profile-card-title">HS Details</span>
                                        </div>
                                        <div class="profile-card-body">
                                            <!-- Row 1: HS ID -->
                                            <div class="profile-field-row">
                                                <div class="profile-field-label">HS ID</div>
                                                <div class="profile-field-value">
                                                    <span>{healthSystem.hsId}</span>
                                                    <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                        variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                        data-field="hsId" data-section="overview" class="profile-edit-icon"></lightning-button-icon>
                                                </div>
                                            </div>
                                            <!-- Row 2: HS Name -->
                                            <div class="profile-field-row">
                                                <div class="profile-field-label">HS Name</div>
                                                <div class="profile-field-value">
                                                    <span>{healthSystem.hsName}</span>
                                                    <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                        variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                        data-field="hsName" data-section="overview" class="profile-edit-icon"></lightning-button-icon>
                                                </div>
                                            </div>
                                            <!-- Row 3: Status -->
                                            <div class="profile-field-row">
                                                <div class="profile-field-label">Status</div>
                                                <div class="profile-field-value">
                                                    <span class="status-badge status-active">
                                                        <lightning-icon icon-name="utility:success" size="xx-small" class="status-icon"></lightning-icon>
                                                        {healthSystem.status}
                                                    </span>
                                                    <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                        variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                        data-field="status" data-section="overview" class="profile-edit-icon"></lightning-button-icon>
                                                </div>
                                            </div>
                                            <!-- Row 4: Annual Patient Volume -->
                                            <div class="profile-field-row">
                                                <div class="profile-field-label">Annual Patient Volume</div>
                                                <div class="profile-field-value">
                                                    <span>120,000</span>
                                                    <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                        variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                        data-field="patientVolume" data-section="overview" class="profile-edit-icon"></lightning-button-icon>
                                                </div>
                                            </div>
                                            <!-- Row 5: State -->
                                            <div class="profile-field-row">
                                                <div class="profile-field-label">State</div>
                                                <div class="profile-field-value">
                                                    <span>{healthSystem.state}</span>
                                                    <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                        variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                        data-field="state" data-section="overview" class="profile-edit-icon"></lightning-button-icon>
                                                </div>
                                            </div>
                                            <!-- Row 6: City -->
                                            <div class="profile-field-row">
                                                <div class="profile-field-label">City</div>
                                                <div class="profile-field-value">
                                                    <span>{healthSystem.city}</span>
                                                    <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                        variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                        data-field="city" data-section="overview" class="profile-edit-icon"></lightning-button-icon>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Contact Details Card -->
                                <div class="slds-col slds-size_1-of-3 slds-p-horizontal_small">
                                    <div class="profile-card">
                                        <div class="profile-card-header">
                                            <lightning-icon icon-name="standard:contact" size="small" class="profile-card-icon"></lightning-icon>
                                            <span class="profile-card-title">Contact Details</span>
                                            <button class="add-contact-btn" onclick={handleAddContact}>
                                                <lightning-icon icon-name="utility:add" size="xx-small"></lightning-icon>
                                                Add Contact
                                            </button>
                                        </div>
                                        <div class="profile-card-body">
                                            <!-- Contact Person Info -->
                                            <div class="contact-person-header">
                                                <div class="contact-person-info">
                                                    <span class="contact-person-name">{healthSystem.contact}</span>
                                                    <span class="contact-person-role">Medical Director</span>
                                                </div>
                                                <div class="contact-person-actions">
                                                    <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                        variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                        data-field="contact" data-section="overview"></lightning-button-icon>
                                                    <lightning-button-icon icon-name="utility:delete" size="x-small"
                                                        variant="bare" alternative-text="Delete"></lightning-button-icon>
                                                </div>
                                            </div>
                                            <!-- Contact Details -->
                                            <div class="contact-detail-row">
                                                <lightning-icon icon-name="utility:company" size="xx-small" class="contact-icon"></lightning-icon>
                                                <span>Medical Director</span>
                                            </div>
                                            <div class="contact-detail-row">
                                                <lightning-icon icon-name="utility:email" size="xx-small" class="contact-icon"></lightning-icon>
                                                <span>{healthSystem.email}</span>
                                            </div>
                                            <div class="contact-detail-row">
                                                <lightning-icon icon-name="utility:call" size="xx-small" class="contact-icon"></lightning-icon>
                                                <span>{healthSystem.phone}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- DX Team Card -->
                                <div class="slds-col slds-size_1-of-3 slds-p-horizontal_small">
                                    <div class="profile-card">
                                        <div class="profile-card-header">
                                            <lightning-icon icon-name="standard:groups" size="small" class="profile-card-icon"></lightning-icon>
                                            <span class="profile-card-title">DX Team</span>
                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                variant="bare" alternative-text="Edit DX Team" onclick={handleEditDxTeam}
                                                class="dx-team-edit-btn"></lightning-button-icon>
                                        </div>
                                        <div class="profile-card-body">
                                            <!-- Coordinator Name Label -->
                                            <div class="dx-team-label">Coordinator Name</div>
                                            <!-- Coordinator Profile -->
                                            <div class="dx-team-profile">
                                                <div class="dx-team-avatar">
                                                    <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Coordinator Avatar" />
                                                </div>
                                                <div class="dx-team-info">
                                                    <span class="dx-team-name">James Mitchell</span>
                                                    <span class="dx-team-email">jmitchell@dxhealth.com</span>
                                                </div>
                                            </div>
                                            <!-- Phone -->
                                            <div class="dx-team-contact-row">
                                                <lightning-icon icon-name="utility:call" size="xx-small" class="dx-team-icon"></lightning-icon>
                                                <span>+1 415-555-0208</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
            
                                <div class="slds-col slds-size_1-of-3 slds-p-horizontal_small">
                                    <div class="slds-card" style="border:1px solid #cfcfcf; border-radius: 0px;">
                                        <div style="background-color:#425b63;color:white;padding:10px;font-weight:700;">
                                            Project Scoping Questionnaire</div>
                                        <div style="padding:10px; background: rgb(230, 247, 255);">
                                            <table
                                                style="width:100%;border-collapse:collapse;background:#e6f7ff; margin-top: -10px;">
                                                <thead>
                                                    <!-- <tr>
                                                                    <th style="text-align:left;padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">Field</th>
                                                                    <th style="text-align:left;padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#333;font-weight:600;">Value</th>
                                                                </tr> -->
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Trial Details</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span>Phase II clinical trial evaluating retinal
                                                                biomarkers</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="scoping"
                                                                data-field="trialDetails"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Planned Site Count</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span>12</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="scoping"
                                                                data-field="plannedSiteCount"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Primary study objective</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span>Evaluate safety and efficacy of retinal AI
                                                                assessment</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="scoping"
                                                                data-field="primaryObjective"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Information Type</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span>Clinical Imaging</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="scoping"
                                                                data-field="informationType"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Study Objectives (Secondary/Tertiary)</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span>Secondary: biomarker correlation; Tertiary: longitudinal
                                                                progression</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="scoping"
                                                                data-field="secondaryObjectives"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Statistical Analysis Required?</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span><input type="checkbox" disabled checked /></span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="scoping"
                                                                data-field="statisticalAnalysis"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Study Population Criteria</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span>Adults 50-85 with early Alzheimer's diagnosis</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="scoping"
                                                                data-field="populationCriteria"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Expected Timeline</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span>Q3 2026 - Q2 2027</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="scoping"
                                                                data-field="expectedTimeline"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Study Exclusions</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span>Concurrent severe ocular disease or uncontrolled
                                                                diabetes</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="scoping"
                                                                data-field="studyExclusions"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Is Health System Chosen?</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span><input type="checkbox" disabled /></span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="scoping"
                                                                data-field="healthSystemChosen"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Participant Enrollment Target</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span>200</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="scoping"
                                                                data-field="enrollmentTarget"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Submitted by</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#0b4a6f;">
                                                            <span>Aleksandra Fornal</span>
            
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col slds-size_1-of-3 slds-p-horizontal_small">
                                    <div class="slds-card" style="border:1px solid #cfcfcf; border-radius: 0px">
                                        <div style="background-color:#425b63;color:white;padding:10px;font-weight:700;">
                                            Document/Agreement Status</div>
                                        <div style="padding:10px;background:#fffce4;">
                                            <table style="width:100%;border-collapse:collapse;    margin-top: -10px;">
                                                <thead>
                                                    <!-- <tr>
                                                                    <th style="text-align:left;padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">Field</th>
                                                                    <th style="text-align:left;padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#333;font-weight:600;">Value</th>
                                                                </tr> -->
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Project Planning Overview</td>
                                                        <td class="value-cell">
                                                            <span>Initial planning completed; milestones and resource
                                                                allocation defined.</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="documents"
                                                                data-field="planningOverview"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style="
                    padding:8px 0;
                    border-top:1px solid #eee;
                    color:#333;
                    font-weight:600;
                ">
                                                            <span style="margin-right:10px;     display: block;">Project
                                                                Scoping</span>
                                                            <span>Two-pager</span>
                                                        </td>
            
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#333;">
                                                            <span>Datosx Approved</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="documents"
                                                                data-field="twoPager"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style="
                    padding:8px 0;
                    border-top:1px solid #eee;
                    color:#333;
                    font-weight:600;
                ">
                                                            <span style="margin-right:10px;     display: block;">Project
                                                                Scoping</span>
                                                            <span>Two-pager Document</span>
                                                        </td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#333;">
                                                            <span style="color:#01b7f2">View Document</span>
                                                            <lightning-button-icon icon-name="utility:edit" size="x-small"
                                                                variant="bare" alternative-text="Edit" onclick={handleInlineEdit}
                                                                data-section="documents"
                                                                data-field="twoPager"></lightning-button-icon>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Created By</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#333;">
                                                            <span>Aleksandra Fornal, 10/27/2025, 6:13 PM</span>
            
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td
                                                            style="padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">
                                                            Last Modified By</td>
                                                        <td class="value-cell"
                                                            style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#333;">
                                                            <span>Aleksandra Fornal, 10/27/2025, 6:13 PM</span>
            
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </template>

        <template if:true={isRequirements}>
            <section role="tabpanel" aria-expanded="true"
                class="record-home-requirements record-home-tab tabs__content active uiTab">
                <div class="slds-card slds-m-top_small">
                    <div class="slds-card__body slds-card__body_inner">
                        <div class="slds-grid slds-grid_pull-padded">
                            <!-- Requirements: render a grid card for each static capability group (4 total) -->
                            <template for:each={displayCapabilityGroups} for:item="group" for:index="idx">
                                <div key={group.id} class="slds-col slds-size_1-of-4 slds-p-horizontal_small">
                                    <div class="slds-card" style="border:1px solid #cfcfcf; border-radius: 0px">
                                        <div style="background-color:#425b63;color:white;padding:10px;font-weight:700;">
                                            {group.title}</div>
                                        <div class={group.bodyClass}>
                                            <table style="width:100%;border-collapse:collapse;    margin-top: -10px;">
                                                <thead>
                                                    <tr>
                                                        <!-- <th style="text-align:left;padding:8px 0;border-top:1px solid #eee;color:#333;font-weight:600;">Field</th>
                                                        <th style="text-align:center;padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;color:#333;font-weight:600;">Value</th> -->
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template for:each={group.items} for:item="item">
                                                        <tr key={item.id}>
                                                            <td
                                                                style="padding:8px 0;border-top:1px solid #eee;color:#333;">
                                                                {item.label}</td>
                                                            <td
                                                                style="padding:8px 12px;border-top:1px solid #eee;border-left:1px solid #eee;text-align:center;">
                                                                <input type="checkbox" checked={item.projectNeeds} />
                                                            </td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </template>

                        </div>
                    </div>
                </div>
            </section>
        </template>

        <!-- Messaging tab content -->
        <template if:true={isMessaging}>
            <section role="tabpanel" aria-expanded="true"
                class="record-home-messaging record-home-tab tabs__content active uiTab">
                <div class="slds-card slds-m-top_small messaging-card">
                    <div class="slds-card__body slds-card__body_inner">
                        <div class="messaging-container" style="display:flex;flex-direction:column;gap:1.5rem;min-height:660px;background:#f3f2f1;padding:1.5rem;border-radius:20px;border:1px solid #d0d0d0;">
                            <div class="outlook-toolbar" style="display:flex;justify-content:space-between;gap:1rem;align-items:center;flex-wrap:wrap;">
                                <div style="display:flex;gap:0.5rem;">
                                    <button class={sponsorsTabClass} data-tab="sponsors" onclick={handleMessagingTabClick} style="border-radius:999px;padding:0.45rem 1.25rem;">Sponsors ({sponsorsCount})</button>
                                    <button class={healthSystemsTabClass} data-tab="healthSystems" onclick={handleMessagingTabClick} style="border-radius:999px;padding:0.45rem 1.25rem;">Health Systems ({healthSystemsCount})</button>
                                </div>
                                <div style="display:flex;gap:0.5rem;align-items:center;flex:1;min-width:260px;">
                                    <input type="text" class="messaging-search-input" placeholder="Search" style="flex:1;border-radius:999px;padding:0.5rem 1.25rem;border:1px solid #c8c6c4;background:#fff;" />
                                    <button style="background:#0078d4;color:white;border:none;padding:0.45rem 1.25rem;border-radius:6px;">Filter</button>
                                </div>
                            </div>
                            <div class="outlook-header" style="background:#ffffff;border-radius:14px;border:1px solid #d2d0ce;padding:0.75rem 1rem;display:flex;justify-content:space-between;gap:1rem;align-items:center;flex-wrap:wrap;">
                                <div style="display:flex;gap:0.5rem;align-items:center;">
                                    <button style="background:#0078d4;color:white;border:none;padding:0.55rem 1.4rem;border-radius:6px;font-weight:600;">New mail</button>
                                    <button style="background:white;border:1px solid #c8c6c4;padding:0.45rem 0.9rem;border-radius:6px;color:#323130;">Delete</button>
                                    <button style="background:white;border:1px solid #c8c6c4;padding:0.45rem 0.9rem;border-radius:6px;color:#323130;">Archive</button>
                                    <button style="background:white;border:1px solid #c8c6c4;padding:0.45rem 0.9rem;border-radius:6px;color:#323130;">Report</button>
                                    <button style="background:white;border:1px solid #c8c6c4;padding:0.45rem 0.9rem;border-radius:6px;color:#323130;">Move to</button>
                                    <button style="background:white;border:1px solid #c8c6c4;padding:0.45rem 0.9rem;border-radius:6px;color:#323130;">Reply all</button>
                                    <button style="background:white;border:1px solid #c8c6c4;padding:0.45rem 0.9rem;border-radius:6px;color:#323130;">Read / Unread</button>
                                    <button style="background:white;border:1px solid #c8c6c4;padding:0.45rem 0.9rem;border-radius:6px;color:#323130;">Flag / Unflag</button>
                                </div>
                                <div style="display:flex;gap:0.75rem;align-items:center;">
                                    <div style="display:flex;flex-direction:column;text-align:right;">
                                        <span style="font-size:0.85rem;color:#5a5a5a;">navin@optionmatrix.com</span>
                                        <span style="font-size:0.8rem;color:#8a8886;">Focused Inbox</span>
                                    </div>
                                    <button style="background:white;border:1px solid #c8c6c4;padding:0.45rem 0.9rem;border-radius:6px;color:#323130;">Undo</button>
                                </div>
                            </div>

                            

                            <div class="outlook-main" style="display:grid;grid-template-columns:220px 360px 1fr;gap:1rem;flex:1;min-height:0;">
                                <aside class="outlook-folders" style="background:#faf9f8;border:1px solid #d2d0ce;border-radius:12px;padding:1rem;display:flex;flex-direction:column;gap:1rem;">
                                    <div>
                                        <h5 style="margin:0 0 0.75rem;font-size:0.85rem;font-weight:600;color:#605e5c;">Favorites</h5>
                                        <ul style="list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:0.15rem;font-size:0.93rem;color:#201f1e;">
                                            <li style="display:flex;justify-content:space-between;align-items:center;padding:0.25rem 0.45rem;border-radius:6px;background:#e3f2fd;color:#0f6cbd;font-weight:600;">
                                                <span>Inbox</span>
                                                <span>{visibleMessagingContacts.length}</span>
                                            </li>
                                            <li style="display:flex;justify-content:space-between;align-items:center;padding:0.25rem 0.45rem;">
                                                <span>Sent Items</span>
                                                <span>48</span>
                                            </li>
                                            <li style="display:flex;justify-content:space-between;align-items:center;padding:0.25rem 0.45rem;">
                                                <span>Drafts</span>
                                                <span>3</span>
                                            </li>
                                            <li style="display:flex;justify-content:space-between;align-items:center;padding:0.25rem 0.45rem;">
                                                <span>Deleted Items</span>
                                                <span>16</span>
                                            </li>
                                            <li style="display:flex;justify-content:space-between;align-items:center;padding:0.25rem 0.45rem;">
                                                <span>Junk Email</span>
                                                <span>30</span>
                                            </li>
                                            <li style="display:flex;justify-content:space-between;align-items:center;padding:0.25rem 0.45rem;">
                                                <span>Archive</span>
                                                <span>5</span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h5 style="margin:1rem 0 0.4rem;font-size:0.85rem;font-weight:600;color:#605e5c;">Folders</h5>
                                        <div style="display:flex;flex-direction:column;gap:0.3rem;font-size:0.9rem;color:#201f1e;">
                                            <span>Conversation History</span>
                                            <span>Notes</span>
                                            <span>Go to Groups</span>
                                        </div>
                                    </div>
                                </aside>

                                <section class="outlook-message-list" style="background:#fff;border:1px solid #d2d0ce;border-radius:12px;display:flex;flex-direction:column;min-height:0;">
                                    <div style="display:flex;justify-content:space-between;border-bottom:1px solid #edebe9;padding:0.65rem 1rem;align-items:center;">
                                        <div style="display:flex;gap:1rem;align-items:center;">
                                            <button style="background:none;border:none;color:#0f6cbd;font-weight:600;font-size:0.95rem;position:relative;padding:0;">
                                                Focused
                                                <span style="position:absolute;left:0;bottom:-8px;width:100%;height:2px;background:#0f6cbd;display:block;"></span>
                                            </button>
                                            <button style="background:none;border:none;color:#605e5c;font-size:0.95rem;">Other</button>
                                        </div>
                                        <span style="color:#8a8886;font-size:0.8rem;">Sort | Filter</span>
                                    </div>
                                    <div class="messaging-contacts-list" style="flex:1;overflow:auto;padding:0;">
                                        <template for:each={visibleMessagingContacts} for:item="contact">
                                            <article key={contact.id} data-id={contact.id} onclick={handleMessagingContactClick}
                                                class={contact.itemClass} style="position:relative;display:flex;gap:0.75rem;align-items:center;padding:0.85rem 1rem;border-bottom:1px solid #edebe9;cursor:pointer;background:#ffffff;">
                                                <template if:true={contact.active}>
                                                    <span style="position:absolute;left:0;top:0;bottom:0;width:4px;background:#0078d4;border-top-right-radius:4px;border-bottom-right-radius:4px;"></span>
                                                </template>
                                                <span class="avatar" style="width:38px;height:38px;border-radius:50%;overflow:hidden;flex-shrink:0;border:2px solid #ffffff;box-shadow:0 0 0 1px #edebe9;">
                                                    <img src={contact.avatar} alt={contact.name} style="width:100%;height:100%;object-fit:cover;" />
                                                </span>
                                                <div style="flex:1;min-width:0;">
                                                    <div style="display:flex;justify-content:space-between;align-items:center;gap:0.5rem;">
                                                        <h6 class="messaging-contact-item-name" style="margin:0;font-size:0.95rem;font-weight:600;color:#323130;">{contact.name}</h6>
                                                        <span style="font-size:0.75rem;color:#8a8886;">Wed 2:39 AM</span>
                                                    </div>
                                                    <p style="margin:0;color:#605e5c;font-size:0.82rem;">Arrive at your goals faster with new learning resources.</p>
                                                    <p style="margin:0.15rem 0 0;color:#a19f9d;font-size:0.78rem;">Get from where you are to where you&apos;re going.</p>
                                                </div>
                                                <template if:true={contact.unread}>
                                                    <span class="messaging-unread-badge" style="background:#107c10;color:white;border-radius:50%;min-width:24px;height:24px;font-size:0.7rem;">{contact.unread}</span>
                                                </template>
                                            </article>
                                        </template>
                                    </div>
                                </section>

                                <section class="outlook-detail" style="background:#f5f6f8;border:1px solid #d2d0ce;border-radius:12px;display:flex;flex-direction:column;min-height:0;">
                                    <div style="background:#ffffff;border-top-left-radius:12px;border-top-right-radius:12px;border-bottom:1px solid #edebe9;padding:1.25rem;display:flex;justify-content:space-between;align-items:center;gap:1rem;">
                                        <div>
                                            <h2 style="margin:0;font-size:1.2rem;color:#252423;">Project Intake Confirmation  <template if:true={selectedContact}>{selectedContact.name}</template><template if:false={selectedContact}>datosX Partner</template></h2>
                                        </div>
                                        <div style="display:flex;gap:0.65rem;align-items:center;color:#5c2d91;">
                                            <lightning-icon icon-name="utility:reply" variant="bare" size="small"></lightning-icon>
                                            <lightning-icon icon-name="utility:reply_all" variant="bare" size="small"></lightning-icon>
                                            <lightning-icon icon-name="utility:forward" variant="bare" size="small"></lightning-icon>
                                            <lightning-icon icon-name="utility:table" variant="bare" size="small"></lightning-icon>
                                        </div>
                                    </div>
                                    <div style="padding:17px;overflow:auto;flex:1;">
                                        <div style="background:#ffffff;border-radius:16px;border:1px solid #edebe9;padding:1.5rem;box-shadow:0 4px 12px rgba(28,26,25,0.05);max-width:734px;margin:0 auto;">
                                            <template if:true={selectedContact}>
                                                <div style="display:flex;justify-content:space-between;gap:1rem;align-items:flex-start;margin-bottom:1.25rem;">
                                                    <div style="display:flex;gap:0.85rem;align-items:center;">
                                                        <span class="avatar" style="width:52px;height:52px;border-radius:50%;overflow:hidden;background:#cfe4ff;display:inline-flex;align-items:center;justify-content:center;font-weight:700;color:#17427c;">
                                                            <img src={selectedContact.avatar} alt={selectedContact.name} style="width:100%;height:100%;object-fit:cover;" />
                                                        </span>
                                                        <div>
                                                            <p style="margin:0;color:#252423;font-weight:600;">{selectedContact.name}</p>
                                                            <p style="margin:0;color:#605e5c;font-size:0.85rem;">intake.notifications@datosx.com</p>
                                                            <p style="margin:0.35rem 0 0;color:#8a8886;font-size:0.8rem;">To: You</p>
                                                        </div>
                                                    </div>
                                                    <span style="color:#8a8886;font-size:0.8rem;">Thu 11/20/2025 09:14 AM</span>
                                                </div>
                                            </template>
                                            <template if:false={selectedContact}>
                                                <p style="color:#605e5c;font-weight:600;margin-bottom:1.5rem;">Select a sponsor or health system to preview its latest email.</p>
                                            </template>
                                            <div style="color:#2f2f2f;font-size:0.95rem;line-height:1.6;margin-bottom:1.5rem;">
                                                <p>Hello team,</p>
                                                <p>We received your most recent project intake package for the "Cerebro DX" collaboration and have started the internal alignment process. Our operations pod is validating site readiness details, enrollment targets, and the requested data provisioning cadence.</p>
                                                <p>Expect a follow-up summary with confirmed milestones within 2 business days. Let us know if there are updates to sponsor expectations or health system availability so we can reflect that in the kickoff deck.</p>
                                                <p>Regards,<br />datosX Intake Desk</p>
                                            </div>
                                            <div style="display:flex;gap:0.75rem;flex-wrap:wrap;margin-bottom:1.5rem;">
                                                <button style="border:1px solid #0078d4;background:#ffffff;color:#0078d4;padding:0.45rem 1.25rem;border-radius:8px;font-weight:600;">Appreciate the quick update.</button>
                                                <button style="border:1px solid #0078d4;background:#ffffff;color:#0078d4;padding:0.45rem 1.25rem;border-radius:8px;font-weight:600;">Please confirm target go-live.</button>
                                            </div>
                                            <div style="display:flex;gap:0.75rem;flex-wrap:wrap;">
                                                <button style="display:flex;align-items:center;gap:0.4rem;border:1px solid #d2d0ce;background:#ffffff;border-radius:8px;padding:0.45rem 1.25rem;font-weight:600;color:#5c2d91;">
                                                    <lightning-icon icon-name="utility:reply" size="x-small" alternative-text="Reply"></lightning-icon>
                                                    Reply
                                                </button>
                                                <button style="display:flex;align-items:center;gap:0.4rem;border:1px solid #d2d0ce;background:#ffffff;border-radius:8px;padding:0.45rem 1.25rem;font-weight:600;color:#0f6cbd;">
                                                    <lightning-icon icon-name="utility:forward" size="x-small" alternative-text="Forward"></lightning-icon>
                                                    Forward
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </template>

        <!-- Legal tab content -->
        <template if:true={isLegal}>
            <section role="tabpanel" aria-expanded="true"
                class="record-home-legal record-home-tab tabs__content active uiTab">
                <div class="slds-card slds-m-top_small legal-card">
                    <div class="slds-card__body slds-card__body_inner">
                        <div class="protocol-container">
                            <!-- Left: Agreement Types -->
                            <div class="protocol-left">
                                <div class="milestone-box" style="width: 228px;">
                                    <div class="milestone-heading">Agreement Types</div>
                                    <div class="step-list" onclick={handleLegalStepClick} style="gap: 4px;">
                                        <template for:each={legalStepsObjs} for:item="lstep">
                                            <div key={lstep.name} data-legal={lstep.name} class={lstep.className} style="padding: 8px 10px; margin-bottom: 2px;">
                                                <div class="step-title">{lstep.name}</div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>

                            <!-- Right: Grid for selected Agreement Type -->
                            <div class="protocol-right">
                                <div class="protocol-grid-header">
                                    <h4><strong>{selectedLegalStep}</strong></h4>
                                </div>
                                <div class="protocol-grid-table">
                                    <table class="protocol-table legal-table" role="grid">
                                        <thead>
                                            <tr>
                                                <th scope="col" class="col-actions">Actions</th>
                                                <th scope="col">Version</th>
                                                <th scope="col">Status</th>
                                                <th scope="col">Initiated By</th>
                                                <th scope="col">HS</th>
                                                <th scope="col">Sponsor</th>
                                                <th scope="col">DX</th>
                                                <th scope="col">Execute</th>
                                                <th scope="col">Due Date</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template for:each={currentLegalRows} for:item="lrow">
                                                <tr key={lrow.id}>
                                                    <td class="col-actions">
                                                        <div class="slds-button-group" role="group">
                                                            <lightning-button-icon icon-name="utility:edit"
                                                                variant="bare" alternative-text="Edit" title="Edit"
                                                                data-id={lrow.id} onclick={handleLegalEdit}
                                                                class="slds-m-right_x-small icon-edit"></lightning-button-icon>
                                                            <lightning-button-icon icon-name="utility:delete"
                                                                variant="bare" alternative-text="Delete" title="Delete"
                                                                data-id={lrow.id} onclick={handleLegalDelete}
                                                                class="icon-delete" style="color: #c23934 !important;"
                                                                icon-class="icon-delete-svg"></lightning-button-icon>
                                                        </div>
                                                    </td>
                                                    <td>{lrow.version}</td>
                                                    <td>{lrow.status}</td>
                                                    <td>{lrow.initiatedBy}</td>
                                                    <td>
                                                        <lightning-avatar src={lrow.hsAvatar}
                                                            alternative-text={lrow.hsName} size="small"
                                                            style="margin-right:8px;"></lightning-avatar>

                                                        <span class="col-label">{lrow.hsName}</span>
                                                    </td>
                                                    <td>
                                                        <lightning-avatar src={lrow.sponsorAvatar}
                                                            alternative-text={lrow.sponsorName} size="small"
                                                            style="margin-right:8px;    "></lightning-avatar>
                                                        <span class="col-label">{lrow.sponsorName}</span>
                                                    </td>
                                                    <td>
                                                        <lightning-avatar src={lrow.dxAvatar}
                                                            alternative-text={lrow.dxName} size="small"
                                                            style="margin-right:8px;"></lightning-avatar>
                                                        <span class="col-label">{lrow.dxName}</span>
                                                    </td>
                                                    <td class="execute-col">
                                                        <button class="execute-btn" data-id={lrow.id} title="Execute"
                                                            onclick={handleExecuteClick}>
                                                            <lightning-icon icon-name="utility:chevronright"
                                                                alternative-text="Execute"
                                                                size="x-small"></lightning-icon>
                                                        </button>
                                                    </td>
                                                    <td style="text-align:left">{lrow.dueDate}</td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </template>

        <!-- Notes tab content -->
        <template if:true={isNotes}>
            <section role="tabpanel" aria-expanded="true" class="record-home-related record-home-tab tabs__content active uiTab">
                <div class="slds-card slds-m-top_small notes-card">
                    <div class="slds-card__body slds-card__body_inner">
                        
                        <!-- Add Note Section -->
                        <div class="slds-grid slds-wrap slds-m-bottom_medium">
                            <div class="slds-col slds-size_12-of-12">
                                <article class="slds-card notes-add-card" style="background-color: #ffffff;">
                                    <div class="slds-card__body slds-card__body_inner">
                                        <h2 class="slds-text-heading_medium slds-m-bottom_medium" style="color: rgb(0, 0, 0);font-weight:600">Add Note</h2>
                                        <div class="slds-grid slds-gutters slds-wrap" style="margin-top: -27px;">
                                            <!-- Message Input - Full Width -->
                                            <div class="slds-col slds-size_10-of-12" >
                                                <lightning-input
                                                    type="text"
                                                   
                                                    value={message}
                                                    placeholder="Enter your text..."
                                                    onchange={handleMessageChange}>
                                                </lightning-input>
                                            </div>
                                            <!-- Action Buttons -->
                                            <div class="slds-col slds-size_2-of-12">
                                                <div class="slds-grid slds-m-top_large" style="gap: 4px; justify-content: center;">
                                                    <lightning-button-icon
                                                        icon-name="utility:attach"
                                                        variant="brand"
                                                        alternative-text="Attach file"
                                                        title="Attach file"
                                                        onclick={openfileupload}
                                                        size="large"
                                                        class="large-action-btn">
                                                    </lightning-button-icon>
                                                    <lightning-button
                                                        variant="brand"
                                                        label="Send"
                                                        icon-name="utility:send"
                                                        onclick={addMessage}
                                                        class="large-action-btn"
                                                        style="height: 48px; width: 100px;">
                                                    </lightning-button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </article>
                            </div>
                        </div>

                        <!-- AI Overview Section -->
                        <div class="slds-grid slds-wrap slds-m-bottom_medium">
                            <div class="slds-col slds-size_12-of-12">
                                <div class="slds-card ai-overview-card">
                                    <div class="slds-card__body slds-card__body_inner">
                                        <div class="ai-overview-content">
                                            <div class="ai-header-section">
                                                
                                                
                                                <h3 class="ai-overview-title">AI Overview</h3>
                                            </div>
                                            
                                            <div class="ai-content-section">
                                                <div class="ai-summary-text">
                                                    <p style="color:black">
                                                        Patient John Doe, 55 years old, presented for a routine check-up. He reports feeling well with no
                                                        significant complaints. Physical exam is unremarkable. Blood pressure is slightly elevated at 140/90
                                                        mmHg. Labs are within normal limits. Diagnosis: Mild hypertension. Treatment plan: Continue
                                                        monitoring blood dietary modifications, and schedule a follow-up appointment in 3
                                                        months to re-assess.
                                                    </p>
                                                    
                                                    <template if:true={showMore}>
                                                        <p>
                                                            Remember to always tailor the summary to the specific patient and their unique medical situation,
                                                            ensuring all maintaining clarity and conciseness. Additional details about the patient's medical
                                                            history include previous hospitalizations for minor procedures, regular medication compliance,
                                                            and family history of cardiovascular conditions. The patient has been cooperative throughout
                                                            the examination and understands the importance of lifestyle modifications for managing hypertension.
                                                        </p>
                                                        <p>
                                                            Recommended follow-up actions include: 1) Weekly blood pressure monitoring at home,
                                                            2) Dietary consultation for sodium reduction, 3) Exercise program initiation with gradual intensity increase,
                                                            4) Follow-up appointment in 3 months to assess treatment effectiveness.
                                                        </p>
                                                    </template>
                                                </div>
                                                
                                                <div class="ai-action-section" style="color:blue;">
                                                    <span class="ai-more-text" onclick={handleToggleShowMore}>{showMoreButtonLabel}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Filter and Sort Controls -->
                        <div class="slds-grid slds-wrap slds-m-bottom_medium">
                            <div class="slds-col slds-size_12-of-12">
                                <div class="slds-grid slds-grid_align-end">
                                    <!-- Sort Button -->
                                    <div class="slds-col slds-no-flex slds-m-right_x-small">
                                        <lightning-button
                                            variant="neutral"
                                            label="SORT"
                                            icon-name={sortIconName}
                                            icon-position="left"
                                            onclick={toggleSort}>
                                        </lightning-button>
                                    </div>
                                    <!-- Filter Button -->
                                    <div class="slds-col slds-no-flex">
                                        <lightning-button
                                            variant="neutral"
                                            label="Filter"
                                            icon-name="utility:filterList"
                                            onclick={toggleFilter}>
                                        </lightning-button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Filter Panel (when expanded) -->
                        <template if:true={filterToggle}>
                            <div class="slds-card slds-m-bottom_medium filter-panel">
                                <div class="slds-card__body slds-card__body_inner">
                                    <div class="slds-grid slds-gutters slds-wrap">
                                        <!-- Keyword Search -->
                                        <div class="slds-col slds-size_4-of-12">
                                            <lightning-input
                                                type="text"
                                                label="Keyword"
                                                placeholder="Search by Keyword">
                                            </lightning-input>
                                        </div>

                                        

                                        <!-- Date Range -->
                                        <div class="slds-col slds-size_4-of-12">
                                            <lightning-input
                                                type="date"
                                                label="From Date">
                                            </lightning-input>
                                        </div>

                                        <div class="slds-col slds-size_4-of-12">
                                            <lightning-input
                                                type="date"
                                                label="To Date">
                                            </lightning-input>
                                        </div>

                                        <!-- Filter Actions -->
                                        <div class="slds-col slds-size_12-of-12">
                                            <div class="slds-grid slds-grid_align-end slds-m-top_medium">
                                                <div class="slds-button-group" role="group">
                                                    <lightning-button-icon
                                                        icon-name="utility:search"
                                                        variant="brand"
                                                        alternative-text="Search"
                                                        title="Search"
                                                        class="filter-action-btn">
                                                    </lightning-button-icon>
                                                    <lightning-button-icon
                                                        icon-name="utility:refresh"
                                                        variant="neutral"
                                                        alternative-text="Clear"
                                                        title="Clear"
                                                        class="filter-action-btn">
                                                    </lightning-button-icon>
                                                    <lightning-button-icon
                                                        icon-name="utility:close"
                                                        variant="neutral"
                                                        alternative-text="Close"
                                                        title="Close"
                                                        onclick={toggleFilter}
                                                        class="filter-action-btn">
                                                    </lightning-button-icon>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Chat Messages Table -->
                        <div class="slds-card">
                            <div class="slds-card__body slds-card__body_inner">
                                <div class="custom-table-wrapper">
                                    <table class="slds-table slds-table_cell-buffer slds-table_bordered notes-table">
                                        <thead>
                                            <tr class="slds-line-height_reset">
                                                <th scope="col" class="slds-text-title_caps table-header" style="background-color: #EBEBEB; color: #666666;">Date</th>
                                                <th scope="col" class="slds-text-title_caps table-header" style="background-color: #EBEBEB; color: #666666;">Posted By</th>
                                                <th scope="col" class="slds-text-title_caps table-header" style="background-color: #EBEBEB; color: #666666;">Message</th>
                                                <th scope="col" class="slds-text-title_caps table-header" style="background-color: #EBEBEB; color: #666666;">Context</th>
                                                <th scope="col" class="slds-text-title_caps table-header" style="background-color: #EBEBEB; color: #666666;">Documents</th>
                                                <th scope="col" class="slds-text-title_caps visibility-header" style="background-color: #EBEBEB;">
                                                    <div class="visibility-main-header" style="background-color: #EBEBEB; color: #666666;text-align:center">Visibility</div>
                                                    <div class="visibility-sub-headers">
                                                        <div class="visibility-sub-header" style="background-color: #EBEBEB; color: #666666;">HS</div>
                                                        <div class="visibility-sub-header" style="background-color: #EBEBEB; color: #666666;">SPONSER</div>
                                                    </div>
                                                </th>
                                                <th scope="col" class="slds-text-title_caps table-header" style="background-color: #EBEBEB; color: #666666;">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template for:each={chatMessages} for:item="msg">
                                                <tr key={msg.id} class="slds-hint-parent table-row">
                                                    <td data-label="Date" class="table-cell">
                                                        <strong>
                                                            <lightning-formatted-date-time 
                                                                value={msg.date} 
                                                                year="numeric" 
                                                                month="short" 
                                                                day="2-digit" 
                                                                hour="2-digit" 
                                                                minute="2-digit">
                                                            </lightning-formatted-date-time>
                                                        </strong>
                                                    </td>
                                                    <td data-label="Posted By" class="table-cell">
                                                        <strong>{msg.postedBy}</strong>
                                                    </td>
                                                    <td data-label="Message" class="slds-cell-wrap word-wrap table-cell">
                                                        {msg.message}
                                                    </td>
                                                    <td data-label="Context" class="table-cell">
                                                        {msg.context}
                                                    </td>
                                                    <td data-label="Documents" class="table-cell">
                                                        <template if:true={msg.hasDocument}>
                                                            <a href="#" class="document-view-link" onclick={handleViewDocument} data-id={msg.id}>
                                                                View
                                                            </a>
                                                        </template>
                                                        <template if:false={msg.hasDocument}>
                                                            <span class="no-document">-</span>
                                                        </template>
                                                    </td>
                                                    <td data-label="Visibility" class="visibility-cell">
                                                        <div class="visibility-checkboxes">
                                                            <div class="visibility-checkbox-wrapper">
                                                                <input type="checkbox" 
                                                                       id={msg.hsCheckboxId}
                                                                       class="visibility-checkbox"
                                                                       checked={msg.hsVisible}
                                                                       onchange={handleHSVisibilityChange}
                                                                       data-id={msg.id}>
                                                            </div>
                                                            <div class="visibility-checkbox-wrapper">
                                                                <input type="checkbox" 
                                                                       id={msg.cvpCheckboxId}
                                                                       class="visibility-checkbox"
                                                                       checked={msg.cvpVisible}
                                                                       onchange={handleCVPVisibilityChange}
                                                                       data-id={msg.id}>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td data-label="Actions" class="table-cell" style="text-align: center;">
                                                        <div style="display: flex; gap: 8px; justify-content: center; align-items: center;">
                                                            <lightning-button-icon
                                                                icon-name="utility:edit"
                                                                alternative-text="Edit"
                                                                title="Edit"
                                                                onclick={handleEditMessage}
                                                                data-id={msg.id}
                                                                class="action-btn edit-btn"
                                                                style="background: none; border: none; color: #0070D2;">
                                                            </lightning-button-icon>
                                                            <lightning-button-icon
                                                                icon-name="utility:delete"
                                                                alternative-text="Delete"
                                                                title="Delete"
                                                                onclick={handleDeleteMessage}
                                                                data-id={msg.id}
                                                                class="action-btn delete-btn"
                                                                style="background: none; border: none; color: #D73232;">
                                                            </lightning-button-icon>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </section>
        </template>

        <!-- Project Tab Content -->
        <template if:true={isProject}>
            <template if:false={showProjectDetail}>
            <section role="tabpanel" aria-expanded="true"
                class="record-home-project record-home-tab tabs__content active uiTab">
                <div class="slds-card slds-m-top_small">
                    <div class="slds-card__body slds-card__body_inner">
                        <!-- Projects Table -->
                        <div class="table-wrapper">
                            <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                                <thead>
                                    <tr class="slds-line-height_reset">
                                        <th scope="col">
                                            <div class="slds-truncate">Actions</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Project ID</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Project Name</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Project Status</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Completion</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Sponsor</div>
                                        </th>
                                        
                                        <th scope="col">
                                            <div class="slds-truncate">Documents</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Notes</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Messages</div>
                                        </th>
                                        
                                        <th scope="col">
                                            <div class="slds-truncate">State</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">City</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Contact</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Email</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Phone</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Last Updated</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={projectsData} for:item="row">
                                        <tr key={row.id}>
                                            <td>
                                                <div class="slds-button-group" role="group">
                                                    <lightning-button-icon icon-name="utility:edit" variant="bare"
                                                        alternative-text="Edit" title="Edit" data-id={row.id}
                                                        class="slds-m-right_x-small icon-edit">
                                                    </lightning-button-icon>
                                                    <lightning-button-icon icon-name="utility:delete" variant="bare"
                                                        alternative-text="Delete" title="Delete" data-id={row.id}
                                                        class="icon-delete"
                                                        style="color: #c23934 !important;" icon-class="icon-delete-svg">
                                                    </lightning-button-icon>
                                                </div>
                                            </td>
                                            <td>
                                                <button class="link-like" data-id={row.id} onclick={handleProjectClick}
                                                    style="background:none;border:none;padding:0;margin:0;color:#0176d3;cursor:pointer">
                                                    <div class="slds-truncate hyper" style="color:blue">{row.projectId}</div>
                                                </button>
                                            </td>
                                            <td>
                                                <button class="link-like" data-id={row.id} onclick={handleProjectClick}
                                                    style="background:none;border:none;padding:0;margin:0;color:#0176d3;cursor:pointer">
                                                    <div class="slds-truncate hyper">{row.projectName}</div>
                                                </button>
                                            </td>
                                            <td>
                                                <span class={row.statusClass}>
                                                    {row.status}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="slds-truncate" style="text-align: center;">{row.completion}%</div>
                                            </td>
                                            <td>
                                                <div class="contact-cell" style="display:flex; align-items:center; gap:0.5rem;">
                                                    <lightning-avatar src={row.sponsorPhoto} alternative-text={row.sponsorName}
                                                        initials={row.sponsorInitials} size="small"></lightning-avatar>
                                                    <div class="contact-name slds-truncate">{row.sponsorName}</div>
                                                </div>
                                            </td>
                                            
                                            <td>
                                                <div class="slds-truncate center-link-cell">{row.documents}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate center-link-cell">{row.notes}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate center-link-cell">{row.messages}</div>
                                            </td>
                                            
                                            <td>
                                                <div class="slds-truncate">{row.state}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate">{row.city}</div>
                                            </td>
                                            <td>
                                                <div class="contact-cell" style="display:flex; align-items:center; gap:0.5rem;">
                                                    <lightning-avatar src={row.contactPhoto} alternative-text={row.contact}
                                                        initials={row.contactInitials} size="small"></lightning-avatar>
                                                    <div class="contact-name slds-truncate">{row.contact}</div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate">{row.email}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate">{row.phone}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate">{row.lastUpdated}</div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            </template>

            <!-- Project Detail View -->
            <template if:true={showProjectDetail}>
                <c-project-detail project={selectedProject} onback={handleBackFromProjectDetail}></c-project-detail>
            </template>
        </template>

        <!-- Possibilities Tab Content -->
        <template if:true={isPossibilities}>
            <section role="tabpanel" aria-expanded="true"
                class="record-home-possibilities record-home-tab tabs__content active uiTab">
                <div class="slds-card slds-m-top_small">
                    <div class="slds-card__body slds-card__body_inner">
                        <!-- Possibilities Table -->
                        <div class="table-wrapper">
                            <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                                <thead>
                                    <tr class="slds-line-height_reset">
                                        <th scope="col">
                                            <div class="slds-truncate">Enquiry ID</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Sponsor Name</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Project Name</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Project Details</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Project Scoping Doc</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Requirements</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">% Matching</div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Interested</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={possibilitiesData} for:item="row">
                                        <tr key={row.id}>
                                            <td>
                                                <div class="slds-truncate">{row.enquiryId}</div>
                                            </td>
                                            <td>
                                                <div class="contact-cell">
                                                    <lightning-avatar alternative-text={row.sponsorName}
                                                        initials={row.sponsorInitials} size="small"></lightning-avatar>
                                                    <div class="contact-name slds-truncate">{row.sponsorName}</div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate">{row.productName}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate">{row.productDetails}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate" style="text-align:center">
                                                    <span class="link-blue">{row.productScopingDoc}</span>
                                                </div>
                                            </td>
                                            <td>
                                                <div  class="slds-truncate" style="text-align:center">
                                                    <span class="link-blue" onclick={handleRequirementsClick} data-id={row.id}>{row.requirements}</span>
                                                </div>
                                            </td>
                                            <td>
                                                <div  style="text-align:center" class="slds-truncate">{row.matchingPercentage}%</div>
                                            </td>
                                            <td>
                                                <lightning-input type="checkbox"  style="text-align:center"
                                                    checked={row.interested}
                                                    data-id={row.id}
                                                    onchange={handleInterestedChange}>
                                                </lightning-input>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </template>
    </div>

    <!-- Global Execute Confirmation Modal (always present so it opens regardless of active tab) -->
    <template if:true={isExecuteOpen}>
        <div class="modal-overlay" onclick={handleExecuteOverlayClick}>
            <div class="modal-card" role="dialog" onclick={stopPropagation} style="width: 339px;">
                <div class="modal-header">
                    <h3>Execute</h3>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to execute?</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-light" onclick={closeExecutePopup}>No</button>
                    <button class="btn btn-primary" onclick={confirmExecute}>Yes</button>
                </div>
            </div>
        </div>
    </template>

    <!-- Interested Confirmation Modal -->
    <template if:true={isInterestedConfirmOpen}>
        <div class="modal-overlay" onclick={handleInterestedOverlayClick}>
            <div class="modal-card" role="dialog" onclick={stopPropagation}>
                <div class="modal-header">
                    <h3>Confirm Interest</h3>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to mark this enquiry as interested?</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-light" onclick={closeInterestedPopup}>Cancel</button>
                    <button class="btn btn-primary" onclick={confirmInterested}>Confirm</button>
                </div>
            </div>
        </div>
    </template>

    <!-- Requirements Modal -->
    <template if:true={isRequirementsModalOpen}>
        <div class="modal-overlay" onclick={handleRequirementsOverlayClick}>
            <div class="modal-card modal-card--xl requirements-modal" role="dialog" onclick={stopPropagation}>
                <div class="modal-header">
                    <h3>Requirements Details</h3>
                    <button class="modal-close-btn" title="Close dialog" onclick={closeRequirementsModal}>
                        <lightning-icon icon-name="utility:close" size="x-small"></lightning-icon>
                    </button>
                </div>
                <div class="modal-body requirements-modal-body">
                    <div class="requirements-layout">
                        <!-- Side Navigation -->
                        <div class="requirements-sidebar">
                            <button class={facilitiesNavClass} data-tab="facilities" onclick={handleRequirementTabClick}>
                                <span>Facilities Available</span>
                            </button>
                            <button class={therapeuticAreaNavClass} data-tab="therapeuticArea" onclick={handleRequirementTabClick}>
                                <span>Therapeutic Area of Focus</span>
                            </button>
                            <button class={innovationFormatNavClass} data-tab="innovationFormat" onclick={handleRequirementTabClick}>
                                <span>Innovation Format Interest</span>
                            </button>
                            <button class={innovationEndUserNavClass} data-tab="innovationEndUser" onclick={handleRequirementTabClick}>
                                <span>Innovation End User Focus</span>
                            </button>
                        </div>

                        <!-- Content Area -->
                        <div class="requirements-content">
                            <template if:true={activeRequirementGroup}>
                                <div class="requirements-card">
                                    <div class="requirements-card__header">
                                        <!-- <h4>{activeRequirementGroup.title}</h4> -->
                                        <p>Requirements for this enquiry.</p>
                                    </div>
                                    <div class="requirements-list">
                                        <template for:each={activeRequirementItems} for:item="req">
                                            <div key={req.id} class="requirements-row">
                                                <span class="requirements-label">{req.label}</span>
                                                <lightning-input type="checkbox" checked={req.checked} ></lightning-input>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </template>
</template>