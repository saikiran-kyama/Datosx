<template>
    <div class="pipeline-container">
        <!-- Enquiry Inner Screen View -->
        <template if:true={showEnquiryInnerScreen}>
            <c-enquirey-inner-screen 
                enquiry-id={currentEnquiryId}
                onback={handleBackToList}>
            </c-enquirey-inner-screen>
        </template>

        <!-- Main Pipeline Master View -->
        <template if:false={showEnquiryInnerScreen}>
            <!-- Horizontal Tabs - Outside table container -->
        <div class="tabs-wrapper slds-m-top_medium">
            <ul class="horizontal-tabs-list" role="tablist">
                <li class={healthSystemsClass} role="presentation">
                    <a href="javascript:void(0);" 
                       role="tab"
                       data-tab="healthSystems"
                       onclick={handleTabClick}
                       aria-selected={isHealthSystems}
                       class="tab-link">
                        Health Systems
                    </a>
                </li>
                <li class={sponsorsClass} role="presentation">
                    <a href="javascript:void(0);" 
                       role="tab"
                       data-tab="sponsors"
                       onclick={handleTabClick}
                       aria-selected={isSponsors}
                       class="tab-link">
                        Sponsors
                    </a>
                </li>
                <li class={enquiriesClass} role="presentation">
                    <a href="javascript:void(0);" 
                       role="tab"
                       data-tab="enquiries"
                       onclick={handleTabClick}
                       aria-selected={isEnquiries}
                       class="tab-link">
                        Enquiries
                    </a>
                </li>
            </ul>
        </div>

        <!-- Content Area -->
        <div class="content-wrapper slds-m-top_small">
            <div class="slds-card">
                <!-- Action Bar -->
                <div class="slds-card__header slds-grid">
                    <!-- <div class="slds-media slds-media_center slds-has-flexi-truncate">
                        <div class="slds-media__body">
                            <h2 class="slds-card__header-title">
                                <template if:true={isHealthSystems}>
                                    <span>Health Systems</span>
                                </template>
                                <template if:true={isSponsors}>
                                    <span>Sponsors</span>
                                </template>
                                <template if:true={isEnquiries}>
                                    <span>Enquiries</span>
                                </template>
                                <template if:true={isProjects}>
                                    <span>Projects</span>
                                </template>
                            </h2>
                        </div>
                    </div> -->
                    <div class="slds-no-flex" style="width: 100%;">
                        <div class="action-buttons-separated" style="display: flex; justify-content: flex-end; align-items: center; gap: 12px; width: 100%;">
                            <lightning-input 
                                type="search" 
                                placeholder="Search..." 
                                variant="label-hidden"
                                style="width: 250px;">
                            </lightning-input>
                            <button class="btn-filter-toggle"
                                style="background-color: #f4f6f9; color: #16325c; border: 1px solid #d8dde6; border-radius: 4px; padding: 6px 14px;"
                                onclick={handleFilter}>
                                <span class="filter-icon-wrapper"><lightning-icon icon-name="utility:filterList" size="x-small"></lightning-icon></span>
                                <span class="filter-label" style="margin-left: 8px;">Filter</span>
                            </button>
                            <button class="btn-filter-toggle"
                                style="background-color: #2e37a4 !important; color: white !important; border: none; border-radius: 4px; padding: 6px 14px; position: relative;"
                                onclick={handleAdd}>
                                <span
                                    style="color: white; font-size: 1.5rem; position: absolute; top: 41%; left: 25%; transform: translate(-50%, -50%);"><b>+</b></span>
                                <span style="color: white; margin-left: 1.5rem;"><b>Add</b></span>
                            </button>
                        </div>
                    </div>
                </div>
        
                <!-- Filter Section - Health Systems -->
                <template if:true={showFilters}>
                    <template if:true={isHealthSystems}>
                        <div class="custom-filter-panel">
                            <div class="filter-header">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h4>Filter</h4>
                                    <a onclick={clearAllFilters}>Clear All</a>
                                </div>
                            </div>
                            <div class="filter-body">
                                <div class="filter-grid">
                                    
                                    <!-- Status Filter -->
                                    <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">Status</label>
                                        </div>
                                        <div class="dropdown-container">
                                            <button class="dropdown-btn" onclick={toggleStatusDropdown}>
                                                <span>{statusDisplayText}</span>
                                                <span class="chevron">▼</span>
                                            </button>
                                            <div class={statusDropdownClass}>
                                                <ul class="dropdown-options">
                                                    <template for:each={statusOptions} for:item="opt">
                                                        <li key={opt.value}>
                                                            <label>
                                                                <input type="checkbox" value={opt.value} checked={opt.checked}
                                                                    onchange={handleStatusCheckboxChange}>
                                                                {opt.label}
                                                            </label>
                                                        </li>
                                                    </template>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- City Filter -->
                                    <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">City</label>
                                        </div>
                                        <div class="dropdown-container">
                                            <button class="dropdown-btn" onclick={toggleCityDropdown}>
                                                <span>{cityDisplayText}</span>
                                                <span class="chevron">▼</span>
                                            </button>
                                            <div class={cityDropdownClass}>
                                                <ul class="dropdown-options">
                                                    <template for:each={cityOptions} for:item="opt">
                                                        <li key={opt.value}>
                                                            <label>
                                                                <input type="checkbox" value={opt.value} checked={opt.checked}
                                                                    onchange={handleCityCheckboxChange}>
                                                                {opt.label}
                                                            </label>
                                                        </li>
                                                    </template>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- State Filter -->
                                    <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">State</label>
                                        </div>
                                        <div class="dropdown-container">
                                            <button class="dropdown-btn" onclick={toggleStateDropdown}>
                                                <span>{stateDisplayText}</span>
                                                <span class="chevron">▼</span>
                                            </button>
                                            <div class={stateDropdownClass}>
                                                <ul class="dropdown-options">
                                                    <template for:each={stateOptions} for:item="opt">
                                                        <li key={opt.value}>
                                                            <label>
                                                                <input type="checkbox" value={opt.value} checked={opt.checked}
                                                                    onchange={handleStateCheckboxChange}>
                                                                {opt.label}
                                                            </label>
                                                        </li>
                                                    </template>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">From Date</label>
                                        </div>
                                        <div class="input-wrapper">
                                            <input name="fromDate" class="filter-input" type="date" value={filterFromDate} onchange={handleFilterChange} />
                                        </div>
                                    </div> -->

                                    <!-- To Date -->
                                    <!-- <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">To Date</label>
                                        </div>
                                        <div class="input-wrapper">
                                            <input name="toDate" class="filter-input" type="date" value={filterToDate} onchange={handleFilterChange} />
                                        </div>
                                    </div> -->

                                </div>
                            </div>

                            <div class="filter-footer">
                                <div class="footer-actions">
                                    <a class="btn-close" onclick={closeFilter}>Close</a>
                                    <button class="btn-filter" onclick={applyFilter}>Filter</button>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Filter Section - Sponsors -->
                    <template if:true={isSponsors}>
                        <div class="custom-filter-panel">
                            <div class="filter-header">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h4>Filter</h4>
                                    <a onclick={clearAllFilters}>Clear All</a>
                                </div>
                            </div>
                            <div class="filter-body">
                                <div class="filter-grid">
                                    
                                    <!-- Status Filter -->
                                    <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">Status</label>
                                        </div>
                                        <div class="dropdown-container">
                                            <button class="dropdown-btn" onclick={toggleStatusDropdown}>
                                                <span>{statusDisplayText}</span>
                                                <span class="chevron">▼</span>
                                            </button>
                                            <div class={statusDropdownClass}>
                                                <ul class="dropdown-options">
                                                    <template for:each={statusOptions} for:item="opt">
                                                        <li key={opt.value}>
                                                            <label>
                                                                <input type="checkbox" value={opt.value} checked={opt.checked}
                                                                    onchange={handleStatusCheckboxChange}>
                                                                {opt.label}
                                                            </label>
                                                        </li>
                                                    </template>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- City Filter -->
                                    <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">City</label>
                                        </div>
                                        <div class="dropdown-container">
                                            <button class="dropdown-btn" onclick={toggleCityDropdown}>
                                                <span>{cityDisplayText}</span>
                                                <span class="chevron">▼</span>
                                            </button>
                                            <div class={cityDropdownClass}>
                                                <ul class="dropdown-options">
                                                    <template for:each={cityOptions} for:item="opt">
                                                        <li key={opt.value}>
                                                            <label>
                                                                <input type="checkbox" value={opt.value} checked={opt.checked}
                                                                    onchange={handleCityCheckboxChange}>
                                                                {opt.label}
                                                            </label>
                                                        </li>
                                                    </template>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- State Filter -->
                                    <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">State</label>
                                        </div>
                                        <div class="dropdown-container">
                                            <button class="dropdown-btn" onclick={toggleStateDropdown}>
                                                <span>{stateDisplayText}</span>
                                                <span class="chevron">▼</span>
                                            </button>
                                            <div class={stateDropdownClass}>
                                                <ul class="dropdown-options">
                                                    <template for:each={stateOptions} for:item="opt">
                                                        <li key={opt.value}>
                                                            <label>
                                                                <input type="checkbox" value={opt.value} checked={opt.checked}
                                                                    onchange={handleStateCheckboxChange}>
                                                                {opt.label}
                                                            </label>
                                                        </li>
                                                    </template>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">From Date</label>
                                        </div>
                                        <div class="input-wrapper">
                                            <input name="fromDate" class="filter-input" type="date" value={filterFromDate} onchange={handleFilterChange} />
                                        </div>
                                    </div> -->

                                    <!-- To Date -->
                                    <!-- <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">To Date</label>
                                        </div>
                                        <div class="input-wrapper">
                                            <input name="toDate" class="filter-input" type="date" value={filterToDate} onchange={handleFilterChange} />
                                        </div>
                                    </div> -->

                                </div>
                            </div>

                            <div class="filter-footer">
                                <div class="footer-actions">
                                    <a class="btn-close" onclick={closeFilter}>Close</a>
                                    <button class="btn-filter" onclick={applyFilter}>Filter</button>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Filter Section - Enquiries -->
                    <template if:true={isEnquiries}>
                        <div class="custom-filter-panel">
                            <div class="filter-header">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h4>Filter</h4>
                                    <a onclick={clearAllFilters}>Clear All</a>
                                </div>
                            </div>
                            <div class="filter-body">
                                <div class="filter-grid">
                                    
                                    <!-- Status Filter -->
                                    <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">Status</label>
                                        </div>
                                        <div class="dropdown-container">
                                            <button class="dropdown-btn" onclick={toggleStatusDropdown}>
                                                <span>{statusDisplayText}</span>
                                                <span class="chevron">▼</span>
                                            </button>
                                            <div class={statusDropdownClass}>
                                                <ul class="dropdown-options">
                                                    <template for:each={statusOptions} for:item="opt">
                                                        <li key={opt.value}>
                                                            <label>
                                                                <input type="checkbox" value={opt.value} checked={opt.checked}
                                                                    onchange={handleStatusCheckboxChange}>
                                                                {opt.label}
                                                            </label>
                                                        </li>
                                                    </template>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- City Filter -->
                                    <!-- <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">City</label>
                                        </div>
                                        <div class="dropdown-container">
                                            <button class="dropdown-btn" onclick={toggleCityDropdown}>
                                                <span>{cityDisplayText}</span>
                                                <span class="chevron">▼</span>
                                            </button>
                                            <div class={cityDropdownClass}>
                                                <ul class="dropdown-options">
                                                    <template for:each={cityOptions} for:item="opt">
                                                        <li key={opt.value}>
                                                            <label>
                                                                <input type="checkbox" value={opt.value} checked={opt.checked}
                                                                    onchange={handleCityCheckboxChange}>
                                                                {opt.label}
                                                            </label>
                                                        </li>
                                                    </template>
                                                </ul>
                                            </div>
                                        </div>
                                    </div> -->

                                    <!-- State Filter -->
                                    <!-- <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">State</label>
                                        </div>
                                        <div class="dropdown-container">
                                            <button class="dropdown-btn" onclick={toggleStateDropdown}>
                                                <span>{stateDisplayText}</span>
                                                <span class="chevron">▼</span>
                                            </button>
                                            <div class={stateDropdownClass}>
                                                <ul class="dropdown-options">
                                                    <template for:each={stateOptions} for:item="opt">
                                                        <li key={opt.value}>
                                                            <label>
                                                                <input type="checkbox" value={opt.value} checked={opt.checked}
                                                                    onchange={handleStateCheckboxChange}>
                                                                {opt.label}
                                                            </label>
                                                        </li>
                                                    </template>
                                                </ul>
                                            </div>
                                        </div>
                                    </div> -->

                                    <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">From Date</label>
                                        </div>
                                        <div class="input-wrapper">
                                            <input name="fromDate" class="filter-input" type="date" value={filterFromDate} onchange={handleFilterChange} />
                                        </div>
                                    </div>

                                    <!-- To Date -->
                                    <div class="filter-item">
                                        <div class="filter-item-header">
                                            <label class="form-label">To Date</label>
                                        </div>
                                        <div class="input-wrapper">
                                            <input name="toDate" class="filter-input" type="date" value={filterToDate} onchange={handleFilterChange} />
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="filter-footer">
                                <div class="footer-actions">
                                    <a class="btn-close" onclick={closeFilter}>Close</a>
                                    <button class="btn-filter" onclick={applyFilter}>Filter</button>
                                </div>
                            </div>
                        </div>
                    </template>
                </template>
        
                <!-- Table Content -->
                <div class="slds-card__body slds-card__body_inner table-container">
                    <!-- Health Systems Table -->
                    <template if:true={isHealthSystems}>
                        <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                            <thead>
                                <tr class="slds-line-height_reset" style="height: 36px;">
                                    <th scope="col" style="width: 120px; padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate">Actions</div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="id" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>HS ID</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="name" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>HS Name</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="status" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Status</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="city" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>City</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="state" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>State</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="contact" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Contact Person</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="email" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Email ID</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="phone" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Phone</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="lastUpdated" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Last Updated</span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={currentData} for:item="record">
                                    <tr key={record.id} class="slds-hint-parent">
                                        <td>
                                            <div class="action-buttons-cell">
                                                <lightning-button-icon icon-name="utility:edit" alternative-text="Edit"
                                                    title="Edit" variant="bare" class="edit-icon" data-id={record.id}
                                                    onclick={handleEdit}>
                                                </lightning-button-icon>
                                                <lightning-button-icon icon-name="utility:delete" alternative-text="Delete"
                                                    title="Delete" variant="bare" class="delete-icon" data-id={record.id}
                                                    onclick={handleDelete}>
                                                </lightning-button-icon>
                                                <lightning-button-icon icon-name="utility:check" alternative-text="Promote"
                                                    title="Promote to Partner" variant="bare" class="promote-icon" data-id={record.id}
                                                    onclick={openPromoteModal} disabled={record.promoteDisabled}>
                                                </lightning-button-icon>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.id}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate name-with-avatar">
                                                <span class="profile-avatar">{record.nameInitial}</span>
                                                <span>{record.name}</span>
                                            </div>
                                        </td>
                                        <td class="status-cell">
                                            <span class={record.statusClass}>{record.status}</span>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.city}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.state}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate name-with-avatar">
                                                <span class="profile-avatar">{record.contactInitial}</span>
                                                <span>{record.contact}</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.email}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.phone}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.lastUpdated}</div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </template>
        
                    <!-- Sponsors Table -->
                    <template if:true={isSponsors}>
                        <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                            <thead>
                                <tr class="slds-line-height_reset" style="height: 36px;">
                                    <th scope="col" style="width: 120px; padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate">Actions</div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="id" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Sponsor ID</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="name" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Sponsor Name</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="status" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Status</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="city" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>City</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="state" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>State</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="contact" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Contact Person</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="email" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Email ID</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="phone" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Phone</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="lastUpdated" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Last Updated</span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={currentData} for:item="record">
                                    <tr key={record.id} class="slds-hint-parent">
                                        <td>
                                            <div class="action-buttons-cell">
                                                <lightning-button-icon icon-name="utility:edit" alternative-text="Edit"
                                                    title="Edit" variant="bare" class="edit-icon" data-id={record.id}
                                                    onclick={handleEdit}>
                                                </lightning-button-icon>
                                                <lightning-button-icon icon-name="utility:delete" alternative-text="Delete"
                                                    title="Delete" variant="bare" class="delete-icon" data-id={record.id}
                                                    onclick={handleDelete}>
                                                </lightning-button-icon>
                                                <lightning-button-icon icon-name="utility:check" alternative-text="Promote"
                                                    title="Promote to Partner" variant="bare" class="promote-icon" data-id={record.id}
                                                    onclick={openPromoteModal} disabled={record.promoteDisabled}>
                                                </lightning-button-icon>
                                                
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.id}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate name-with-avatar">
                                                <span class="profile-avatar">{record.nameInitial}</span>
                                                <span>{record.name}</span>
                                            </div>
                                        </td>
                                        <td class="status-cell">
                                            <span class={record.statusClass}>{record.status}</span>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.city}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.state}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate name-with-avatar">
                                                <span class="profile-avatar">{record.contactInitial}</span>
                                                <span>{record.contact}</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.email}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.phone}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.lastUpdated}</div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </template>
        
                    <!-- Enquiries Table -->
                    <template if:true={isEnquiries}>
                        <table class="slds-table slds-table_bordered slds-table_cell-buffer table-rounded enquiries-table">
                            <thead>
                                <tr class="slds-line-height_reset" style="height: 36px;">
                                    <th scope="col" style="width: 120px; padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate">Actions</div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="enquiryId" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Enquiry ID</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="status" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Enquiry Status</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="sponsorName" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Sponsor Name</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="projectName" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Project Name</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="projectDetails" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Project Details</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="projectScopingDoc" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Project Scoping Doc</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="hsAllocated" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>HS Allocated</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="dateCreated" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Date Created</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="lastUpdated" onclick={handleSort} style="padding-top: 4px; padding-bottom: 4px;">
                                        <div class="slds-truncate header-content">
                                            <span>Last Updated</span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={currentData} for:item="record">
                                    <tr key={record.id} class="slds-hint-parent">
                                        <td>
                                            <div class="action-buttons-cell">
                                                <lightning-button-icon icon-name="utility:edit" alternative-text="Edit"
                                                    title="Edit" variant="bare" class="edit-icon" data-id={record.id}
                                                    onclick={handleEdit}>
                                                </lightning-button-icon>
                                                <lightning-button-icon icon-name="utility:delete" alternative-text="Delete"
                                                    title="Delete" variant="bare" class="delete-icon" data-id={record.id}
                                                    onclick={handleDelete}>
                                                </lightning-button-icon>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">
                                                <a href="javascript:void(0);"
                                                    style="color: #0176d3; font-weight: 600; text-decoration: none; cursor: pointer;"
                                                    data-id={record.id} onclick={handleEnquiryClick}>{record.enquiryId}</a>
                                            </div>
                                        </td>
                                        <td class="status-cell">
                                            <span class={record.statusClass}>{record.status}</span>
                                        </td>
                                        <td>
                                            <div class="slds-truncate name-with-avatar">
                                                <span class="profile-avatar">{record.sponsorInitial}</span>
                                                <span>{record.sponsorName}</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.projectName}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.projectDetails}</div>
                                        </td>
                                            <td style="text-align:center;">
                                                <template if:true={record.hasDocument}>
                                                    <span style="color: #0176d3; cursor: pointer; font-weight: 600; text-align:center;">View</span>
                                                </template>
                                                <template if:false={record.hasDocument}>
                                                    <span style="color: #706e6b; text-align:center;">-</span>
                                                </template>
                                            </td>
                                        <td>
                                            <div class="slds-truncate">{record.hsAllocated}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.dateCreated}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.lastUpdated}</div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </template>
        
                    <!-- Projects Table -->
                    <template if:true={isProjects}>
                        <table class="slds-table slds-table_bordered slds-table_cell-buffer table-rounded">
                            <thead>
                                <tr class="slds-line-height_reset">
                                    <th scope="col" style="width: 120px;">
                                        <div class="slds-truncate">Actions</div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="projectId" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Project ID</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="projectName" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Project Name</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="status" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Project Status</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="completion" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Completion</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="sponsorName" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Sponsor</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="healthSystemName" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>HS</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="documents" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Documents</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="notes" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Notes</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="messages" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Messages</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="lastUpdated" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Last Updated</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="state" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>State</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="city" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>City</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="contact" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Contact</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="email" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Email</span>
                                        </div>
                                    </th>
                                    <th scope="col" class="sortable-header" data-field="phone" onclick={handleSort}>
                                        <div class="slds-truncate header-content">
                                            <span>Phone</span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={currentData} for:item="record">
                                    <tr key={record.projectId} class="slds-hint-parent">
                                        <td>
                                            <div class="action-buttons-cell">
                                                <lightning-button-icon icon-name="utility:edit" alternative-text="Edit"
                                                    title="Edit" variant="bare" class="edit-icon" data-id={record.projectId}
                                                    onclick={handleEdit}>
                                                </lightning-button-icon>
                                                <lightning-button-icon icon-name="utility:delete" alternative-text="Delete"
                                                    title="Delete" variant="bare" class="delete-icon" data-id={record.projectId}
                                                    onclick={handleDelete}>
                                                </lightning-button-icon>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.projectId}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.projectName}</div>
                                        </td>
                                        <td class="status-cell">
                                            <span class={record.statusClass}>{record.status}</span>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.completion}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate name-with-avatar">
                                                <span class="profile-avatar">{record.sponsorInitial}</span>
                                                <span>{record.sponsorName}</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate name-with-avatar">
                                                <span class="profile-avatar">{record.hsInitial}</span>
                                                <span>{record.healthSystemName}</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.documents}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.notes}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.messages}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.lastUpdated}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.state}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.city}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate name-with-avatar">
                                                <span class="profile-avatar">{record.contactInitial}</span>
                                                <span>{record.contact}</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.email}</div>
                                        </td>
                                        <td>
                                            <div class="slds-truncate">{record.phone}</div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </template>
                </div>
        
                <!-- Pagination Footer -->
                <div>
                    <div class="pagination-container-right">
                        <c-paginator total-size={totalSize} page-size={pageSize} page-index={pageIndex}
                            page-size-options={pageSizeOptions} onpagechange={handlePageChange}>
                        </c-paginator>
                    </div>
                </div>
            </div>
        </div>
        
        </template>

        <!-- Enquiries Intake Modal (project-style) -->
        <template if:true={isAddProjectModalOpen}>
            <div class="modal-overlay" onclick={handleAddProjectOverlayClick}>
                <div class="modal-card modal-card--xl" onclick={stopAddProjectModalPropagation}>
                    <div class="modal-header intake-modal-header">
                        <div>
                            <h3>New Enquiry Intake</h3>
                        </div>
                        <button class="modal-close-btn" title="Close dialog" onclick={closeAddProjectModal}>
                            <lightning-icon icon-name="utility:close" size="x-small"></lightning-icon>
                        </button>
                    </div>
                    <div class="modal-body intake-modal-body" style="overflow: hidden;">
                        <div class="intake-layout">
                            <div class="intake-sidebar">
                                <template for:each={addModalTabsWithState} for:item="tab">
                                    <button key={tab.id} class={tab.className} data-tab={tab.id}
                                        onclick={handleAddProjectTabClick}>
                                        <span>{tab.label}</span>
                                    </button>
                                </template>
                            </div>
                            <div class="intake-content">
                                <template if:true={isAddTabDetails}>
                                    <div class="intake-section">
                                        <!-- <div class="intake-section-header">
                                            <h4>Project Details</h4>
                                            <p>Match sponsor context, owners, and enrollment targets.</p>
                                        </div> -->
                                        <div class="intake-two-column">
                                            <div class="left-col">
                                                <div class="intake-field">
                                                    <label>Project ID <span class="required">*</span></label>
                                                    <lightning-input name="projectId" value={newProjectForm.projectId}
                                                        onchange={handleAddProjectInputChange}
                                                        placeholder="Enter project id"></lightning-input>

                                                </div>

                                                <div class="intake-field">
                                                    <label>Project Status</label>
                                                    <lightning-combobox name="status" options={addModalStatusOptions}
                                                        value={newProjectForm.status} placeholder="--None--"
                                                        onchange={handleAddProjectInputChange}></lightning-combobox>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Project Name <span class="required">*</span></label>
                                                    <lightning-input name="projectName" value={newProjectForm.projectName}
                                                        onchange={handleAddProjectInputChange}
                                                        placeholder="Enter project name"></lightning-input>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Publish Project</label>
                                                    <lightning-input type="checkbox" name="publishProject"
                                                        checked={newProjectForm.publishProject}
                                                        onchange={handleAddProjectInputChange}></lightning-input>
                                                </div>

                                                <div class="intake-field">
                                                    <label>HS Matching Completed</label>
                                                    <lightning-input type="checkbox" name="hsMatchingCompleted"
                                                        checked={newProjectForm.hsMatchingCompleted}
                                                        onchange={handleAddProjectInputChange}></lightning-input>
                                                </div>
                                            </div>

                                            <div class="right-col">
                                                <div class="intake-field">
                                                    <label>Sponsor Company Account</label>
                                                    <div class="lookup-row">
                                                        <lightning-input name="sponsor" type="search"
                                                            placeholder="Search Network Partners..."
                                                            value={newProjectForm.sponsor}
                                                            onchange={handleAddProjectInputChange}
                                                            style="width: 86%;"></lightning-input>
                                                        <button class="lookup-btn" title="Search"><lightning-icon
                                                                icon-name="utility:search"
                                                                size="x-small"></lightning-icon></button>
                                                    </div>
                                                </div>

                                                <div class="intake-field">
                                                    <label>datosX primary contact</label>
                                                    <div class="lookup-row">
                                                        <lightning-input name="primaryContact" type="search"
                                                            placeholder="Search People..."
                                                            value={newProjectForm.primaryContact}
                                                            onchange={handleAddProjectInputChange}
                                                            style="width: 86%;"></lightning-input>
                                                        <button class="lookup-btn" title="Search"><lightning-icon
                                                                icon-name="utility:search"
                                                                size="x-small"></lightning-icon></button>
                                                    </div>
                                                </div>



                                                <div class="intake-field">
                                                    <label>Project Document Url</label>
                                                    <lightning-input type="url" name="documentUrl" placeholder="https://..."
                                                        value={newProjectForm.documentUrl}
                                                        onchange={handleAddProjectInputChange}></lightning-input>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Project Description</label>
                                                    <lightning-textarea name="notes" value={newProjectForm.notes}
                                                        placeholder=""
                                                        onchange={handleAddProjectInputChange}></lightning-textarea>
                                                </div>



                                                <!-- <div class="intake-field">
                                                    <label>Owner</label>
                                                    <div class="owner-display"> 
                                                        <lightning-avatar initials="NM" size="small"></lightning-avatar>
                                                        <span class="owner-name">{newProjectForm.ownerDisplay}</span>
                                                    </div>
                                                </div> -->
                                            </div>
                                        </div>
                                    </div>
                                </template>

                                <template if:true={isAddTabHistory}>
                                    <div class="intake-section">
                                        <div class="intake-field span-2 history-field">

                                            <lightning-textarea class="intake-control history-textarea" name="historyNotes"
                                                label="Project History" placeholder="Enter project history or notes"
                                                value={newProjectForm.historyNotes} rows="8"
                                                onchange={handleAddProjectInputChange}></lightning-textarea>
                                        </div>
                                    </div>
                                </template>

                                <template if:true={isAddTabScoping}>
                                    <div class="intake-section">
                                        <div class="intake-two-column">
                                            <div class="left-col">
                                                <div class="intake-field">
                                                    <label>Trial Details</label>
                                                    <lightning-textarea class="intake-control" name="trialDetails"
                                                        value={newProjectForm.trialDetails} placeholder="Trial details"
                                                        onchange={handleAddProjectInputChange}></lightning-textarea>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Primary study objective</label>
                                                    <lightning-textarea class="intake-control" name="primaryObjective"
                                                        value={newProjectForm.primaryObjective}
                                                        placeholder="Primary objectives"
                                                        onchange={handleAddProjectInputChange}></lightning-textarea>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Study Objectives (Secondary/Tertiary)</label>
                                                    <lightning-textarea class="intake-control" name="studyObjectives"
                                                        value={newProjectForm.studyObjectives}
                                                        placeholder="Secondary objectives"
                                                        onchange={handleAddProjectInputChange}></lightning-textarea>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Study Population Criteria</label>
                                                    <lightning-textarea class="intake-control" name="populationCriteria"
                                                        value={newProjectForm.populationCriteria}
                                                        placeholder="Population criteria"
                                                        onchange={handleAddProjectInputChange}></lightning-textarea>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Statistical Analysis Required?</label>
                                                    <lightning-combobox class="intake-control" name="statAnalysis"
                                                        options={statAnalysisOptions} value={newProjectForm.statAnalysis}
                                                        placeholder="--None--"
                                                        onchange={handleAddProjectInputChange}></lightning-combobox>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Participant Enrollment Target</label>
                                                    <lightning-textarea class="intake-control" name="enrollmentTarget"
                                                        value={newProjectForm.enrollmentTarget}
                                                        placeholder="Enrollment target"
                                                        onchange={handleAddProjectInputChange}></lightning-textarea>
                                                </div>



                                            </div>

                                            <div class="right-col">
                                                <div class="intake-field">
                                                    <label>Planned Site Count</label>
                                                    <lightning-textarea class="intake-control" name="plannedSiteCount"
                                                        value={newProjectForm.plannedSiteCount}
                                                        placeholder="Planned site count"
                                                        onchange={handleAddProjectInputChange}></lightning-textarea>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Information Type</label>
                                                    <lightning-textarea class="intake-control" name="informationType"
                                                        value={newProjectForm.informationType}
                                                        placeholder="Information type"
                                                        onchange={handleAddProjectInputChange}></lightning-textarea>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Study Exclusions</label>
                                                    <lightning-textarea class="intake-control" name="exclusions"
                                                        value={newProjectForm.exclusions} placeholder="Exclusions"
                                                        onchange={handleAddProjectInputChange}></lightning-textarea>
                                                </div>


                                                <div class="intake-field">
                                                    <label>Expected Timeline</label>
                                                    <lightning-textarea class="intake-control" name="timeline"
                                                        value={newProjectForm.timeline} placeholder="Expected timeline"
                                                        onchange={handleAddProjectInputChange}></lightning-textarea>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Is Health System Chosen?</label>
                                                    <lightning-combobox class="intake-control" name="isHealthSystemChosen"
                                                        options={isHealthSystemOptions}
                                                        value={newProjectForm.isHealthSystemChosen} placeholder="--None--"
                                                        onchange={handleAddProjectInputChange}></lightning-combobox>
                                                </div>

                                                <div class="intake-field">
                                                    <label>Submitted by</label>
                                                    <div class="lookup-row">
                                                        <lightning-input class="intake-control" name="submittedBy"
                                                            type="search" placeholder="Search People..."
                                                            value={newProjectForm.submittedBy}
                                                            onchange={handleAddProjectInputChange}></lightning-input>
                                                        <button class="lookup-btn" title="Search"><lightning-icon
                                                                icon-name="utility:search"
                                                                size="x-small"></lightning-icon></button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>

                                <template if:true={isAddTabRequirements}>
                                    <div class="intake-section">
                                        <div class="intake-two-column requirements-two-column">
                                            <div class="right-col">
                                                <div class="intake-field">
                                                    <label>Requirement Type</label>
                                                    <div style="width: 192.475px;">
                                                        <lightning-combobox value={selectedRequirementType}
                                                            options={requirementTypeOptions}
                                                            placeholder="Select requirement type"
                                                            onchange={handleRequirementTypeChange}
                                                            style="width:100%;"></lightning-combobox>
                                                    </div>
                                                    <p class="requirements-help-text">Choose a Requirement Type to edit its
                                                        checklist.</p>
                                                </div>
                                            </div>
                                            <div class="left-col">
                                                <template if:true={activeRequirementGroup}>
                                                    <div class="requirements-card">
                                                        <div class="requirements-card__header">
                                                            <h4>{activeRequirementGroup.title}</h4>
                                                            <p>Toggle the capability needs that apply to this project.</p>
                                                        </div>
                                                        <div class="requirements-list">
                                                            <template for:each={activeRequirementItems} for:item="req">
                                                                <div key={req.id} class="requirements-row">
                                                                    <span class="requirements-label">{req.label}</span>
                                                                    <lightning-input data-group-id={req.groupId}
                                                                        data-item-id={req.id} type="checkbox"
                                                                        checked={req.checked}
                                                                        onchange={handleRequirementCheckboxChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>

                                        </div>
                                    </div>
                                </template>

                                <template if:true={isAddTabDocuments}>
                                    <div class="intake-section">
                                        <div class="intake-two-column">
                                            <div class="left-col">
                                                <div class="intake-field">
                                                    <label>Project Planning Overview</label>
                                                    <lightning-combobox class="intake-control"
                                                        name="projectPlanningOverview" options={documentOptions}
                                                        value={newProjectForm.projectPlanningOverview}
                                                        placeholder="--None--"
                                                        onchange={handleAddProjectInputChange}></lightning-combobox>
                                                </div>
                                            </div>
                                            <div class="right-col">
                                                <div class="intake-field">
                                                    <label>Project Scoping Two-pager</label>
                                                    <lightning-combobox class="intake-control" name="projectScopingTwoPager"
                                                        options={documentOptions}
                                                        value={newProjectForm.projectScopingTwoPager} placeholder="--None--"
                                                        onchange={handleAddProjectInputChange}></lightning-combobox>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer intake-modal-footer">
                        <button class="btn btn-light" onclick={closeAddProjectModal}>Close</button>
                        <button class="btn btn-primary" onclick={handleAddProjectSaveNext}>{addProjectSaveButtonLabel}</button>
                    </div>
                </div>
            </div>
        </template>

        <!-- Add Modal (tab-aware) -->
        <template if:true={showAddModal}>
            <section role="dialog" aria-modal="true" class="hs-modal-backdrop">
                <div class="hs-modal">
                    <div class="hs-modal__header">
                        <div class="hs-modal__title">Add {activeTabLabel}</div>
                        <button class="hs-modal__close" title="Close" onclick={closeAddModal} aria-label="Close">✕</button>
                    </div>
                    <div class="hs-modal__body">
                        <div class="hs-modal__grid">
                            <template if:true={isHealthSystems}>
                                <div class="hs-form-group"><label>HS Name</label><lightning-input name="formName" value={formName} onchange={handleInputChange} placeholder="Enter HS Name"></lightning-input></div>
                                <div class="hs-form-group"><label>Contact Person</label><lightning-input name="formContact" value={formContact} onchange={handleInputChange} placeholder="Enter Contact"></lightning-input></div>
                                <div class="hs-form-group"><label>State</label>
                                    <div class="dropdown-container">
                                        <button class="dropdown-btn" onclick={toggleFormStateDropdown} type="button">
                                            <span>{formStateDisplay}</span>
                                            <span class="chevron">▼</span>
                                        </button>
                                        <div class={formStateDropdownClass}>
                                            <input type="text" class="dropdown-search" placeholder="Search State" oninput={handleFormStateSearchInput} />
                                            <ul class="dropdown-options">
                                                <template for:each={formFilteredStateOptions} for:item="opt">
                                                    <li key={opt.value} data-value={opt.value} onclick={selectFormState}>
                                                        <label>{opt.label}</label>
                                                    </li>
                                                </template>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="hs-form-group"><label>City</label>
                                    <div class="dropdown-container">
                                        <button class="dropdown-btn" onclick={toggleFormCityDropdown} type="button">
                                            <span>{formCityDisplay}</span>
                                            <span class="chevron">▼</span>
                                        </button>
                                        <div class={formCityDropdownClass}>
                                            <input type="text" class="dropdown-search" placeholder="Search City" oninput={handleFormCitySearchInput} />
                                            <ul class="dropdown-options">
                                                <template for:each={formFilteredCityOptions} for:item="opt">
                                                    <li key={opt.value} data-value={opt.value} onclick={selectFormCity}>
                                                        <label>{opt.label}</label>
                                                    </li>
                                                </template>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="hs-form-group"><label>Email ID</label><lightning-input type="email" name="formEmail" value={formEmail} onchange={handleInputChange} placeholder="Enter Email"></lightning-input></div>
                                <div class="hs-form-group"><label>Phone</label><lightning-input type="tel" name="formPhone" value={formPhone} onchange={handleInputChange} placeholder="Enter Phone"></lightning-input></div>
                            </template>
                            <template if:true={isSponsors}>
                                <div class="hs-form-group"><label>Sponsor Name</label><lightning-input name="formName" value={formName} onchange={handleInputChange} placeholder="Enter Sponsor Name"></lightning-input></div>
                                <div class="hs-form-group"><label>Contact Person</label><lightning-input name="formContact" value={formContact} onchange={handleInputChange} placeholder="Enter Contact"></lightning-input></div>
                                <div class="hs-form-group"><label>State</label>
                                    <div class="dropdown-container">
                                        <button class="dropdown-btn" onclick={toggleFormStateDropdown} type="button">
                                            <span>{formStateDisplay}</span>
                                            <span class="chevron">▼</span>
                                        </button>
                                        <div class={formStateDropdownClass}>
                                            <input type="text" class="dropdown-search" placeholder="Search State" oninput={handleFormStateSearchInput} />
                                            <ul class="dropdown-options">
                                                <template for:each={formFilteredStateOptions} for:item="opt">
                                                    <li key={opt.value} data-value={opt.value} onclick={selectFormState}>
                                                        <label>{opt.label}</label>
                                                    </li>
                                                </template>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="hs-form-group"><label>City</label>
                                    <div class="dropdown-container">
                                        <button class="dropdown-btn" onclick={toggleFormCityDropdown} type="button">
                                            <span>{formCityDisplay}</span>
                                            <span class="chevron">▼</span>
                                        </button>
                                        <div class={formCityDropdownClass}>
                                            <input type="text" class="dropdown-search" placeholder="Search City" oninput={handleFormCitySearchInput} />
                                            <ul class="dropdown-options">
                                                <template for:each={formFilteredCityOptions} for:item="opt">
                                                    <li key={opt.value} data-value={opt.value} onclick={selectFormCity}>
                                                        <label>{opt.label}</label>
                                                    </li>
                                                </template>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="hs-form-group"><label>Email ID</label><lightning-input type="email" name="formEmail" value={formEmail} onchange={handleInputChange} placeholder="Enter Email"></lightning-input></div>
                                <div class="hs-form-group"><label>Phone</label><lightning-input type="tel" name="formPhone" value={formPhone} onchange={handleInputChange} placeholder="Enter Phone"></lightning-input></div>
                            </template>
                            <template if:true={isEnquiries}>
                                <div class="hs-form-group" style="grid-column: 1;">
                                    <label>Sponsor Name</label>
                                    <lightning-input name="formEnquirySponsorName" value={formEnquirySponsorName} onchange={handleInputChange} placeholder="Enter Sponsor Name"></lightning-input>
                                </div>
                                <div class="hs-form-group" style="grid-column: 1;">
                                    <label>Project Name</label>
                                    <lightning-input name="formEnquiryProjectName" value={formEnquiryProjectName} onchange={handleInputChange} placeholder="Enter Project Name"></lightning-input>
                                </div>
                                <div class="hs-form-group" style="grid-column: 2;">
                                    <label>Project Scoping Doc</label>
                                    <lightning-input type="file" name="formEnquiryDoc" onchange={handleDocChange}></lightning-input>
                                    <template if:true={formEnquiryDocName}><p class="file-name">{formEnquiryDocName}</p></template>
                                </div>
                                <div class="hs-form-group" style="grid-column: 1;">
                                    <label>Project Details</label>
                                    <lightning-textarea name="formEnquiryProjectDetails" value={formEnquiryProjectDetails} onchange={handleInputChange} placeholder="Enter Project Details"></lightning-textarea>
                                </div>
                            </template>
                        </div>
                    </div>
                    <div class="hs-modal__footer">
                        <button class="hs-btn-outline" onclick={closeAddModal}>Cancel</button>
                        <button class="hs-btn-primary" onclick={saveAdd}>Save</button>
                    </div>
                </div>
            </section>
        </template>

        <!-- Edit Modal (tab-aware) -->
        <template if:true={showEditModal}>
            <section role="dialog" aria-modal="true" class="hs-modal-backdrop">
                <div class="hs-modal">
                    <div class="hs-modal__header">
                        <div class="hs-modal__title">Edit {activeTabLabel}</div>
                        <button class="hs-modal__close" title="Close" onclick={closeEditModal} aria-label="Close">✕</button>
                    </div>
                    <div class="hs-modal__body">
                        <div class="hs-modal__grid">
                            <template if:true={isHealthSystems}>
                                <div class="hs-form-group"><label>HS Name</label><lightning-input name="formName" value={formName} onchange={handleInputChange} placeholder="Enter HS Name"></lightning-input></div>
                                <div class="hs-form-group"><label>Contact Person</label><lightning-input name="formContact" value={formContact} onchange={handleInputChange} placeholder="Enter Contact"></lightning-input></div>
                                <div class="hs-form-group"><label>State</label>
                                    <div class="dropdown-container">
                                        <button class="dropdown-btn" onclick={toggleFormStateDropdown} type="button">
                                            <span>{formStateDisplay}</span>
                                            <span class="chevron">▼</span>
                                        </button>
                                        <div class={formStateDropdownClass}>
                                            <input type="text" class="dropdown-search" placeholder="Search State" oninput={handleFormStateSearchInput} />
                                            <ul class="dropdown-options">
                                                <template for:each={formFilteredStateOptions} for:item="opt">
                                                    <li key={opt.value} data-value={opt.value} onclick={selectFormState}>
                                                        <label>{opt.label}</label>
                                                    </li>
                                                </template>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="hs-form-group"><label>City</label>
                                    <div class="dropdown-container">
                                        <button class="dropdown-btn" onclick={toggleFormCityDropdown} type="button">
                                            <span>{formCityDisplay}</span>
                                            <span class="chevron">▼</span>
                                        </button>
                                        <div class={formCityDropdownClass}>
                                            <input type="text" class="dropdown-search" placeholder="Search City" oninput={handleFormCitySearchInput} />
                                            <ul class="dropdown-options">
                                                <template for:each={formFilteredCityOptions} for:item="opt">
                                                    <li key={opt.value} data-value={opt.value} onclick={selectFormCity}>
                                                        <label>{opt.label}</label>
                                                    </li>
                                                </template>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="hs-form-group"><label>Email ID</label><lightning-input type="email" name="formEmail" value={formEmail} onchange={handleInputChange} placeholder="Enter Email"></lightning-input></div>
                                <div class="hs-form-group"><label>Phone</label><lightning-input type="tel" name="formPhone" value={formPhone} onchange={handleInputChange} placeholder="Enter Phone"></lightning-input></div>
                            </template>
                            <template if:true={isSponsors}>
                                <div class="hs-form-group"><label>Sponsor Name</label><lightning-input name="formName" value={formName} onchange={handleInputChange} placeholder="Enter Sponsor Name"></lightning-input></div>
                                <div class="hs-form-group"><label>Contact Person</label><lightning-input name="formContact" value={formContact} onchange={handleInputChange} placeholder="Enter Contact"></lightning-input></div>

                                <div class="hs-form-group"><label>State</label>
                                    <div class="dropdown-container">
                                        <button class="dropdown-btn" onclick={toggleFormStateDropdown} type="button">
                                            <span>{formStateDisplay}</span>
                                            <span class="chevron">▼</span>
                                        </button>
                                        <div class={formStateDropdownClass}>
                                            <input type="text" class="dropdown-search" placeholder="Search State" oninput={handleFormStateSearchInput} />
                                            <ul class="dropdown-options">
                                                <template for:each={formFilteredStateOptions} for:item="opt">
                                                    <li key={opt.value} data-value={opt.value} onclick={selectFormState}>
                                                        <label>{opt.label}</label>
                                                    </li>
                                                </template>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="hs-form-group"><label>City</label>
                                    <div class="dropdown-container">
                                        <button class="dropdown-btn" onclick={toggleFormCityDropdown} type="button">
                                            <span>{formCityDisplay}</span>
                                            <span class="chevron">▼</span>
                                        </button>
                                        <div class={formCityDropdownClass}>
                                            <input type="text" class="dropdown-search" placeholder="Search City" oninput={handleFormCitySearchInput} />
                                            <ul class="dropdown-options">
                                                <template for:each={formFilteredCityOptions} for:item="opt">
                                                    <li key={opt.value} data-value={opt.value} onclick={selectFormCity}>
                                                        <label>{opt.label}</label>
                                                    </li>
                                                </template>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="hs-form-group"><label>Email ID</label><lightning-input type="email" name="formEmail" value={formEmail} onchange={handleInputChange} placeholder="Enter Email"></lightning-input></div>
                                <div class="hs-form-group"><label>Phone</label><lightning-input type="tel" name="formPhone" value={formPhone} onchange={handleInputChange} placeholder="Enter Phone"></lightning-input></div>
                            </template>
                            <template if:true={isEnquiries}>
                                <div class="hs-form-group" style="grid-column: 1;">
                                    <label>Status</label>
                                    <lightning-combobox name="formEnquiryStatus" value={formEnquiryStatus} options={enquiryStatusOptions} onchange={handleInputChange}></lightning-combobox>
                                </div>
                                <div class="hs-form-group" style="grid-column: 1;">
                                    <label>Sponsor Name</label>
                                    <lightning-input name="formEnquirySponsorName" value={formEnquirySponsorName} onchange={handleInputChange} placeholder="Enter Sponsor Name"></lightning-input>
                                </div>
                                <div class="hs-form-group" style="grid-column: 1;">
                                    <label>Project Name</label>
                                    <lightning-input name="formEnquiryProjectName" value={formEnquiryProjectName} onchange={handleInputChange} placeholder="Enter Project Name"></lightning-input>
                                </div>
                                <div class="hs-form-group" style="grid-column: 1;">
                                    <label>Project Scoping Doc</label>
                                    <lightning-input type="file" name="formEnquiryDoc" onchange={handleDocChange}></lightning-input>
                                    <template if:true={formEnquiryDocName}><p class="file-name">{formEnquiryDocName}</p></template>
                                </div>
                                <div class="hs-form-group" style="grid-column: 2;">
                                    <label>Project Details</label>
                                    <lightning-textarea name="formEnquiryProjectDetails" value={formEnquiryProjectDetails} onchange={handleInputChange} placeholder="Enter Project Details"></lightning-textarea>
                                </div>
                            </template>
                        </div>
                    </div>
                    <div class="hs-modal__footer">
                        <button class="hs-btn-outline" onclick={closeEditModal}>Cancel</button>
                        <button class="hs-btn-primary" onclick={saveEdit}>Save</button>
                    </div>
                </div>
            </section>
        </template>

        <!-- Promote Confirmation Modal -->
        <template if:true={showPromoteModal}>
            <section role="dialog" aria-modal="true" class="hs-modal-backdrop">
                <div class="hs-modal">
                    <div class="hs-modal__header">
                        <div class="hs-modal__title">Convert to Partner</div>
                        <button class="hs-modal__close" title="Close" onclick={closePromoteModal} aria-label="Close">✕</button>
                    </div>
                    <div class="hs-modal__body">
                        <div class="hs-modal__grid">
                            <div class="hs-form-group hs-form-group--full">
                                <p>Do you confirm to convert <strong>{promoteRecordName}</strong> to <strong>Partner</strong>?</p>
                            </div>
                        </div>
                    </div>
                    <div class="hs-modal__footer">
                        <button class="hs-btn-outline" onclick={closePromoteModal}>Cancel</button>
                        <button class="hs-btn-primary" onclick={confirmPromote}>Confirm</button>
                    </div>
                </div>
            </section>
        </template>

    <!-- Requirements and HS Matches modals removed -->
    </div>
</template>