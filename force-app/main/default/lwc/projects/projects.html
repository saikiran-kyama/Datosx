<template>
    <lightning-card>

        <template if:false={showDetail}>
            <!-- Search Bar and Filter Button -->
            <div class="slds-m-around_small slds-grid slds-grid_align-end" style="gap: 0.5rem;">
                <div class="slds-col">
                    <lightning-input type="search" value={searchKey} onchange={handleSearchChange} placeholder="Search"
                        class="search-bar">
                    </lightning-input>
                </div>

                <div class="slds-col slds-align-bottom">
                    <button class="btn-download" title="Download CSV" aria-label="Download CSV"
                        style="background-color: transparent; border: 1px solid #d8dde6; color: #16325c; border-radius: 4px; padding: 7px 10px; display:flex; align-items:center; gap:0.5rem;">
                        <lightning-icon icon-name="utility:download" size="x-small"></lightning-icon>
                    </button>
                </div>

                <div class="slds-col slds-align-bottom">
                    <button class="btn-download" title="Grid Columns" aria-label="Grid Columns"
                        style="background-color: transparent; border: 1px solid #d8dde6; color: #16325c; border-radius: 4px; padding: 7px 10px; display:flex; align-items:center; gap:0.5rem;">
                        <lightning-icon icon-name="utility:table" size="x-small"></lightning-icon>
                    </button>
                </div>

                <div class="slds-col slds-align-bottom">
                    <button class="btn-filter-toggle"
                        style="background-color: black; color: white; border-radius: 4px; padding: 6px 14px;"
                        onclick={toggleFilters}>
                        <lightning-icon icon-name="utility:filterList" size="x-small"></lightning-icon>Filter
                    </button>
                </div>
                <div class="slds-col slds-align-bottom">
                    <button class="btn-filter-toggle"
                        style="background-color: #2e37a4 !important; color: white !important; border-radius: 4px; padding: 6px 14px; position: relative;"
                        onclick={openAddProjectModal}>
                        <span
                            style="color: white; font-size: 1.5rem; position: absolute; top: 41%; left: 25%; transform: translate(-50%, -50%);"><b>+</b></span>
                        <span style="color: white; margin-left: 1.5rem;"><b>Add</b></span>
                    </button>
                </div>
            </div>

            <!-- FILTER PANEL -->
            <template if:true={showFilters}>
                <div class="custom-filter-panel">
                    <div class="filter-header">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4>Filter</h4>
                            <a onclick={clearAllFilters}>Clear All</a>
                        </div>
                    </div>
                    <div class="filter-body">
                        <div class="filter-grid">

                            <!-- Status Filter -->
                            <div class="filter-item">
                                <div class="filter-item-header">
                                    <label class="form-label">Project Status</label>
                                </div>
                                <div class="dropdown-container">
                                    <button class="dropdown-btn" onclick={toggleStatusDropdown}>
                                        <span>{statusDisplayText}</span>
                                        <span class="chevron">▼</span>
                                    </button>
                                    <div class={statusDropdownClass}>
                                        <ul class="dropdown-options">
                                            <template for:each={statusOptions} for:item="opt">
                                                <li key={opt.value}>
                                                    <label>
                                                        <input type="checkbox" value={opt.value} checked={opt.checked}
                                                            onchange={handleStatusCheckboxChange}>
                                                        {opt.label}
                                                    </label>
                                                </li>
                                            </template>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Sponsor Filter (multi-select) -->
                            <div class="filter-item">
                                <div class="filter-item-header">
                                    <label class="form-label">Sponsor</label>
                                </div>
                                <div class="dropdown-container">
                                    <button class="dropdown-btn" onclick={toggleSponsorDropdown}>
                                        <span>{sponsorDisplayText}</span>
                                        <span class="chevron">▼</span>
                                    </button>
                                    <div class={sponsorDropdownClass}>
                                        <ul class="dropdown-options">
                                            <template for:each={sponsorOptions} for:item="opt">
                                                <li key={opt.value}>
                                                    <label>
                                                        <input type="checkbox" value={opt.value} checked={opt.checked}
                                                            onchange={handleSponsorCheckboxChange}>
                                                        {opt.label}
                                                    </label>
                                                </li>
                                            </template>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Health System Filter -->
                            <div class="filter-item">
                                <div class="filter-item-header">
                                    <label class="form-label">Health System</label>
                                </div>
                                <div class="dropdown-container">
                                    <button class="dropdown-btn" onclick={toggleHealthDropdown}>
                                        <span>{healthDisplayText}</span>
                                        <span class="chevron">▼</span>
                                    </button>
                                    <div class={healthDropdownClass}>
                                        <ul class="dropdown-options">
                                            <template for:each={healthOptions} for:item="opt">
                                                <li key={opt.value}>
                                                    <label>
                                                        <input type="checkbox" value={opt.value} checked={opt.checked}
                                                            onchange={handleHealthCheckboxChange}>
                                                        {opt.label}
                                                    </label>
                                                </li>
                                            </template>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="filter-footer">
                        <div class="footer-actions">
                            <a class="btn-close" onclick={closeFilter}>Close</a>
                            <button class="btn-filter" onclick={applyFilter}>Filter</button>
                        </div>
                    </div>
                </div>
            </template>
        </template>

        <!-- Table Wrapper -->
        <template if:false={showDetail}>
            <div class="table-wrapper">
                <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                    <thead>
                        <tr class="slds-line-height_reset">
                            <th scope="col">
                                <div class="slds-truncate">Actions</div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="projectId" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Project ID</span>
                                    <template if:true={isSortedBy.projectId}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="projectName" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Project Name</span>
                                    <template if:true={isSortedBy.projectName}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="status" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Project Status</span>
                                    <template if:true={isSortedBy.status}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="completion" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Completion</span>
                                    <template if:true={isSortedBy.completion}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="sponsorName" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Sponsor</span>
                                    <template if:true={isSortedBy.sponsorName}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="healthSystemName" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>HS</span>
                                    <template if:true={isSortedBy.healthSystemName}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="documents" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Documents</span>
                                    <template if:true={isSortedBy.documents}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="notes" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Notes</span>
                                    <template if:true={isSortedBy.notes}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="messages" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Messages</span>
                                    <template if:true={isSortedBy.messages}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="lastUpdated" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Last Updated</span>
                                    <template if:true={isSortedBy.lastUpdated}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="state" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>State</span>
                                    <template if:true={isSortedBy.state}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="city" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>City</span>
                                    <template if:true={isSortedBy.city}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="contact" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Contact</span>
                                    <template if:true={isSortedBy.contact}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="email" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Email</span>
                                    <template if:true={isSortedBy.email}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                            <th scope="col" class="sortable-header" data-field="phone" onclick={handleSort}>
                                <div class="slds-truncate header-content">
                                    <span>Phone</span>
                                    <template if:true={isSortedBy.phone}>
                                        <span class={sortDirection}></span>
                                    </template>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={pagedData} for:item="row">
                            <tr key={row.id}>

                                <td>
                                    <div class="slds-button-group" role="group">
                                        <lightning-button-icon icon-name="utility:edit" variant="bare"
                                            alternative-text="Edit" title="Edit" data-id={row.id} onclick={handleEdit}
                                            class="slds-m-right_x-small icon-edit">
                                        </lightning-button-icon>
                                        <lightning-button-icon icon-name="utility:delete" variant="bare"
                                            alternative-text="Delete" title="Delete" data-id={row.id}
                                            onclick={handleDelete} class="icon-delete"
                                            style="color: #c23934 !important;" icon-class="icon-delete-svg">
                                        </lightning-button-icon>
                                    </div>
                                </td>
                                <td>
                                    <button class="link-like" data-id={row.id} onclick={openDetail}
                                        style="background:none;border:none;padding:0;margin:0;color:inherit;cursor:pointer">
                                        <div class="slds-truncate hyper">{row.projectId}</div>
                                    </button>
                                </td>
                                <td>
                                    <button class="link-like" data-id={row.id} onclick={openDetail}
                                        style="background:none;border:none;padding:0;margin:0;color:inherit;cursor:pointer">
                                        <div class="slds-truncate hyper">{row.projectName}</div>
                                    </button>
                                </td>
                                <td>
                                    <span class={row.statusClass}>
                                        {row.status}
                                    </span>
                                </td>
                                <td>
                                    <div class="slds-truncate" style="text-align: center;">{row.completion}%</div>
                                </td>
                                <td>
                                    <div class="contact-cell" style="display:flex; align-items:center; gap:0.5rem;">
                                        <lightning-avatar src={row.sponsorPhoto} alternative-text={row.sponsorName}
                                            initials={row.sponsorInitials} size="small"></lightning-avatar>
                                        <div class="contact-name slds-truncate">{row.sponsorName}</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="contact-cell" style="display:flex; align-items:center; gap:0.5rem;">
                                        <lightning-avatar src={row.healthPhoto} alternative-text={row.healthSystemName}
                                            initials={row.healthInitials} size="small"></lightning-avatar>
                                        <div class="contact-name slds-truncate ">{row.healthSystemName}</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="slds-truncate center-link-cell">{row.documents}</div>
                                </td>
                                <td>
                                    <div class="slds-truncate center-link-cell">{row.notes}</div>
                                </td>
                                <td>
                                    <div class="slds-truncate center-link-cell">{row.messages}</div>
                                </td>
                                <td>
                                    <div class="slds-truncate">{row.lastUpdated}</div>
                                </td>
                                <td>
                                    <div class="slds-truncate">{row.state}</div>
                                </td>
                                <td>
                                    <div class="slds-truncate">{row.city}</div>
                                </td>
                                <td>
                                    <div class="contact-cell" style="display:flex; align-items:center; gap:0.5rem;">
                                        <lightning-avatar src={row.contactPhoto} alternative-text={row.contact}
                                            initials={row.contactInitials} size="small"></lightning-avatar>
                                        <div class="contact-name slds-truncate">{row.contact}</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="slds-truncate">{row.email}</div>
                                </td>
                                <td>
                                    <div class="slds-truncate">{row.phone}</div>
                                </td>

                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>

        </template>

        <!-- Paginator component reused -->
        <template if:false={showDetail}>
            <c-paginator total-size={totalSize} page-size={pageSize} page-index={pageIndex}
                page-size-options={pageSizeOptions} onpagechange={handlePage}></c-paginator>
        </template>

        <!-- Detail view rendered inside Projects App Page -->
        <template if:true={showDetail}>
            <c-project-detail project={selectedProject} onback={handleBack}></c-project-detail>
        </template>

    </lightning-card>

    <template if:true={isAddProjectModalOpen}>
        <div class="modal-overlay" onclick={handleAddProjectOverlayClick}>
            <div class="modal-card modal-card--xl" onclick={stopAddProjectModalPropagation}>
                <div class="modal-header intake-modal-header">
                    <div>
                        <h3>New Project Intake</h3>
                    </div>
                    <button class="modal-close-btn" title="Close dialog" onclick={closeAddProjectModal}>
                        <lightning-icon icon-name="utility:close" size="x-small"></lightning-icon>
                    </button>
                </div>
                <div class="modal-body intake-modal-body" style="overflow: hidden;">
                    <div class="intake-layout">
                        <div class="intake-sidebar">
                            <template for:each={addModalTabsWithState} for:item="tab">
                                <button key={tab.id} class={tab.className} data-tab={tab.id}
                                    onclick={handleAddProjectTabClick}>
                                    <span>{tab.label}</span>
                                </button>
                            </template>
                        </div>
                        <div class="intake-content">
                            <template if:true={isAddTabDetails}>
                                <div class="intake-section">
                                    <!-- <div class="intake-section-header">
                                        <h4>Project Details</h4>
                                        <p>Match sponsor context, owners, and enrollment targets.</p>
                                    </div> -->
                                    <div class="intake-two-column">
                                        <div class="left-col">
                                            <div class="intake-field">
                                                <label>Project ID <span class="required">*</span></label>
                                                <lightning-input name="projectId" value={newProjectForm.projectId}
                                                    onchange={handleAddProjectInputChange}
                                                    placeholder="Enter project id"></lightning-input>

                                            </div>

                                            <div class="intake-field">
                                                <label>Project Status</label>
                                                <lightning-combobox name="status" options={addModalStatusOptions}
                                                    value={newProjectForm.status} placeholder="--None--"
                                                    onchange={handleAddProjectInputChange}></lightning-combobox>
                                            </div>

                                            <div class="intake-field">
                                                <label>Project Name <span class="required">*</span></label>
                                                <lightning-input name="projectName" value={newProjectForm.projectName}
                                                    onchange={handleAddProjectInputChange}
                                                    placeholder="Enter project name"></lightning-input>
                                            </div>

                                            <div class="intake-field">
                                                <label>Publish Project</label>
                                                <lightning-input type="checkbox" name="publishProject"
                                                    checked={newProjectForm.publishProject}
                                                    onchange={handleAddProjectInputChange}></lightning-input>
                                            </div>

                                            <div class="intake-field">
                                                <label>HS Matching Completed</label>
                                                <lightning-input type="checkbox" name="hsMatchingCompleted"
                                                    checked={newProjectForm.hsMatchingCompleted}
                                                    onchange={handleAddProjectInputChange}></lightning-input>
                                            </div>
                                        </div>

                                        <div class="right-col">
                                            <div class="intake-field">
                                                <label>Sponsor Company Account</label>
                                                <div class="lookup-row">
                                                    <lightning-input name="sponsor" type="search"
                                                        placeholder="Search Network Partners..."
                                                        value={newProjectForm.sponsor}
                                                        onchange={handleAddProjectInputChange}
                                                        style="width: 86%;"></lightning-input>
                                                    <button class="lookup-btn" title="Search"><lightning-icon
                                                            icon-name="utility:search"
                                                            size="x-small"></lightning-icon></button>
                                                </div>
                                            </div>

                                            <div class="intake-field">
                                                <label>datosX primary contact</label>
                                                <div class="lookup-row">
                                                    <lightning-input name="primaryContact" type="search"
                                                        placeholder="Search People..."
                                                        value={newProjectForm.primaryContact}
                                                        onchange={handleAddProjectInputChange}
                                                        style="width: 86%;"></lightning-input>
                                                    <button class="lookup-btn" title="Search"><lightning-icon
                                                            icon-name="utility:search"
                                                            size="x-small"></lightning-icon></button>
                                                </div>
                                            </div>



                                            <div class="intake-field">
                                                <label>Project Document Url</label>
                                                <lightning-input type="url" name="documentUrl" placeholder="https://..."
                                                    value={newProjectForm.documentUrl}
                                                    onchange={handleAddProjectInputChange}></lightning-input>
                                            </div>

                                            <div class="intake-field">
                                                <label>Project Description</label>
                                                <lightning-textarea name="notes" value={newProjectForm.notes}
                                                    placeholder=""
                                                    onchange={handleAddProjectInputChange}></lightning-textarea>
                                            </div>



                                            <!-- <div class="intake-field">
                                                <label>Owner</label>
                                                <div class="owner-display"> 
                                                    <lightning-avatar initials="NM" size="small"></lightning-avatar>
                                                    <span class="owner-name">{newProjectForm.ownerDisplay}</span>
                                                </div>
                                            </div> -->
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <template if:true={isAddTabHistory}>
                                <div class="intake-section">
                                    <div class="intake-field span-2 history-field">

                                        <lightning-textarea class="intake-control history-textarea" name="historyNotes"
                                            label="Project History" placeholder="Enter project history or notes"
                                            value={newProjectForm.historyNotes} rows="8"
                                            onchange={handleAddProjectInputChange}></lightning-textarea>
                                    </div>
                                </div>
                            </template>

                            <template if:true={isAddTabScoping}>
                                <div class="intake-section">
                                    <div class="intake-two-column">
                                        <div class="left-col">
                                            <div class="intake-field">
                                                <label>Trial Details</label>
                                                <lightning-textarea class="intake-control" name="trialDetails"
                                                    value={newProjectForm.trialDetails} placeholder="Trial details"
                                                    onchange={handleAddProjectInputChange}></lightning-textarea>
                                            </div>

                                            <div class="intake-field">
                                                <label>Primary study objective</label>
                                                <lightning-textarea class="intake-control" name="primaryObjective"
                                                    value={newProjectForm.primaryObjective}
                                                    placeholder="Primary objectives"
                                                    onchange={handleAddProjectInputChange}></lightning-textarea>
                                            </div>

                                            <div class="intake-field">
                                                <label>Study Objectives (Secondary/Tertiary)</label>
                                                <lightning-textarea class="intake-control" name="studyObjectives"
                                                    value={newProjectForm.studyObjectives}
                                                    placeholder="Secondary objectives"
                                                    onchange={handleAddProjectInputChange}></lightning-textarea>
                                            </div>

                                            <div class="intake-field">
                                                <label>Study Population Criteria</label>
                                                <lightning-textarea class="intake-control" name="populationCriteria"
                                                    value={newProjectForm.populationCriteria}
                                                    placeholder="Population criteria"
                                                    onchange={handleAddProjectInputChange}></lightning-textarea>
                                            </div>

                                            <div class="intake-field">
                                                <label>Statistical Analysis Required?</label>
                                                <lightning-combobox class="intake-control" name="statAnalysis"
                                                    options={statAnalysisOptions} value={newProjectForm.statAnalysis}
                                                    placeholder="--None--"
                                                    onchange={handleAddProjectInputChange}></lightning-combobox>
                                            </div>

                                            <div class="intake-field">
                                                <label>Participant Enrollment Target</label>
                                                <lightning-textarea class="intake-control" name="enrollmentTarget"
                                                    value={newProjectForm.enrollmentTarget}
                                                    placeholder="Enrollment target"
                                                    onchange={handleAddProjectInputChange}></lightning-textarea>
                                            </div>



                                        </div>

                                        <div class="right-col">
                                            <div class="intake-field">
                                                <label>Planned Site Count</label>
                                                <lightning-textarea class="intake-control" name="plannedSiteCount"
                                                    value={newProjectForm.plannedSiteCount}
                                                    placeholder="Planned site count"
                                                    onchange={handleAddProjectInputChange}></lightning-textarea>
                                            </div>

                                            <div class="intake-field">
                                                <label>Information Type</label>
                                                <lightning-textarea class="intake-control" name="informationType"
                                                    value={newProjectForm.informationType}
                                                    placeholder="Information type"
                                                    onchange={handleAddProjectInputChange}></lightning-textarea>
                                            </div>

                                            <div class="intake-field">
                                                <label>Study Exclusions</label>
                                                <lightning-textarea class="intake-control" name="exclusions"
                                                    value={newProjectForm.exclusions} placeholder="Exclusions"
                                                    onchange={handleAddProjectInputChange}></lightning-textarea>
                                            </div>


                                            <div class="intake-field">
                                                <label>Expected Timeline</label>
                                                <lightning-textarea class="intake-control" name="timeline"
                                                    value={newProjectForm.timeline} placeholder="Expected timeline"
                                                    onchange={handleAddProjectInputChange}></lightning-textarea>
                                            </div>

                                            <div class="intake-field">
                                                <label>Is Health System Chosen?</label>
                                                <lightning-combobox class="intake-control" name="isHealthSystemChosen"
                                                    options={isHealthSystemOptions}
                                                    value={newProjectForm.isHealthSystemChosen} placeholder="--None--"
                                                    onchange={handleAddProjectInputChange}></lightning-combobox>
                                            </div>

                                            <div class="intake-field">
                                                <label>Submitted by</label>
                                                <div class="lookup-row">
                                                    <lightning-input class="intake-control" name="submittedBy"
                                                        type="search" placeholder="Search People..."
                                                        value={newProjectForm.submittedBy}
                                                        onchange={handleAddProjectInputChange}></lightning-input>
                                                    <button class="lookup-btn" title="Search"><lightning-icon
                                                            icon-name="utility:search"
                                                            size="x-small"></lightning-icon></button>
                                                </div>
                                            </div>




                                        </div>
                                    </div>
                                </div>
                            </template>

                            <template if:true={isAddTabRequirements}>
                                <div class="intake-section">
                                    <div class="intake-two-column requirements-two-column">
                                        <div class="right-col">
                                            <div class="intake-field">
                                                <label>Requirement Type</label>
                                                <div style="width: 192.475px;">
                                                    <lightning-combobox value={selectedRequirementType}
                                                        options={requirementTypeOptions}
                                                        placeholder="Select requirement type"
                                                        onchange={handleRequirementTypeChange}
                                                        style="width:100%;"></lightning-combobox>
                                                </div>
                                                <p class="requirements-help-text">Choose a Requirement Type to edit its
                                                    checklist.</p>
                                            </div>
                                        </div>
                                        <div class="left-col">
                                            <template if:true={activeRequirementGroup}>
                                                <div class="requirements-card">
                                                    <div class="requirements-card__header">
                                                        <h4>{activeRequirementGroup.title}</h4>
                                                        <p>Toggle the capability needs that apply to this project.</p>
                                                    </div>
                                                    <div class="requirements-list">
                                                        <template for:each={activeRequirementItems} for:item="req">
                                                            <div key={req.id} class="requirements-row">
                                                                <span class="requirements-label">{req.label}</span>
                                                                <lightning-input data-group-id={req.groupId}
                                                                    data-item-id={req.id} type="checkbox"
                                                                    checked={req.checked}
                                                                    onchange={handleRequirementCheckboxChange}></lightning-input>
                                                            </div>
                                                        </template>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>

                                    </div>
                                </div>
                            </template>

                            <template if:true={isAddTabDocuments}>
                                <div class="intake-section">
                                    <div class="intake-two-column">
                                        <div class="left-col">
                                            <div class="intake-field">
                                                <label>Project Planning Overview</label>
                                                <lightning-combobox class="intake-control"
                                                    name="projectPlanningOverview" options={documentOptions}
                                                    value={newProjectForm.projectPlanningOverview}
                                                    placeholder="--None--"
                                                    onchange={handleAddProjectInputChange}></lightning-combobox>
                                            </div>
                                        </div>
                                        <div class="right-col">
                                            <div class="intake-field">
                                                <label>Project Scoping Two-pager</label>
                                                <lightning-combobox class="intake-control" name="projectScopingTwoPager"
                                                    options={documentOptions}
                                                    value={newProjectForm.projectScopingTwoPager} placeholder="--None--"
                                                    onchange={handleAddProjectInputChange}></lightning-combobox>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                <div class="modal-footer intake-modal-footer">
                    <button class="btn btn-light" onclick={closeAddProjectModal}>Close</button>
                    <button class="btn btn-primary" onclick={handleAddProjectSaveNext}>{addProjectSaveButtonLabel}</button>
                </div>
            </div>
        </div>
    </template>
</template>